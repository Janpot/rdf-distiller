<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: JSON::LD::EvaluationContext
  
    &mdash; Web portal for RDF.rb.
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../JSON.html" title="JSON (module)">JSON</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../LD.html" title="JSON::LD (module)">LD</a></span></span>
     &raquo; 
    <span class="title">EvaluationContext</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: JSON::LD::EvaluationContext
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">JSON::LD::EvaluationContext</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Utils.html" title="JSON::LD::Utils (module)">Utils</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb</dd>
  
</dl>
<div class="clear"></div>





  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#base-instance_method" title="#base (instance method)">- (RDF::URI) <strong>base</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The base.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#coercions-instance_method" title="#coercions (instance method)">- (Hash{String =&gt; String}) <strong>coercions</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Type coersion.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#containers-instance_method" title="#containers (instance method)">- (Hash{String =&gt; String}) <strong>containers</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>List coercion.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#context_base-instance_method" title="#context_base (instance method)">- (RDF::URI) <strong>context_base</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Base IRI of the context, if loaded remotely.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_language-instance_method" title="#default_language (instance method)">- (String) <strong>default_language</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Default language.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#iri_to_curie-instance_method" title="#iri_to_curie (instance method)">- (Hash{RDF::URI =&gt; String}) <strong>iri_to_curie</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reverse mappings from IRI to a term or CURIE.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#iri_to_term-instance_method" title="#iri_to_term (instance method)">- (Hash{RDF::URI =&gt; String}) <strong>iri_to_term</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reverse mappings from IRI to term only for terms, not CURIEs.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#languages-instance_method" title="#languages (instance method)">- (Hash{String =&gt; String}) <strong>languages</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Language coercion.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mappings-instance_method" title="#mappings (instance method)">- (Hash{String =&gt; String}) <strong>mappings</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A list of current, in-scope mappings from term to IRI.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- (Hash{Symbol =&gt; Object}) <strong>options</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Global options used in generating IRIs.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#provided_context-instance_method" title="#provided_context (instance method)">- (EvaluationContext) <strong>provided_context</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A context provided to us that we can use without re-serializing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#remote_contexts-instance_method" title="#remote_contexts (instance method)">- (Array&lt;String&gt;) <strong>remote_contexts</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The list of remote contexts already processed.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#vocab-instance_method" title="#vocab (instance method)">- (String) <strong>vocab</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Default vocabulary.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#alias-instance_method" title="#alias (instance method)">- (String) <strong>alias</strong>(value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reverse term mapping, typically used for finding aliases for keys.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#coerce-instance_method" title="#coerce (instance method)">- (RDF::URI, '@id') <strong>coerce</strong>(property) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve term coercion.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compact_iri-instance_method" title="#compact_iri (instance method)">- (String) <strong>compact_iri</strong>(iri, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Compacts an absolute IRI to the shortest matching term or compact IRI.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compact_value-instance_method" title="#compact_value (instance method)">- (Hash) <strong>compact_value</strong>(property, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Compact a value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#container-instance_method" title="#container (instance method)">- (String) <strong>container</strong>(property) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve container mapping, add it if <code>value</code> is provided.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dup-instance_method" title="#dup (instance method)">- (Object) <strong>dup</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expand_iri-instance_method" title="#expand_iri (instance method)">- (RDF::Term, ...) <strong>expand_iri</strong>(iri, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Expand an IRI.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expand_value-instance_method" title="#expand_value (instance method)">- (Hash) <strong>expand_value</strong>(property, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Expand a value from compacted to expanded form making the context
unnecessary.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (EvaluationContext) <strong>initialize</strong>(options = {}) {|ec| ... }</a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create new evaluation context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (Object) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#language-instance_method" title="#language (instance method)">- (String) <strong>language</strong>(property) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve the language associated with a property, or the default language otherwise.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mapping-instance_method" title="#mapping (instance method)">- (RDF::URI, String) <strong>mapping</strong>(term) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve term mapping.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse-instance_method" title="#parse (instance method)">- (Object) <strong>parse</strong>(context) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create an Evaluation Context using an existing context as a start by parsing the input.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#serialize-instance_method" title="#serialize (instance method)">- (Hash) <strong>serialize</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate @context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_coerce-instance_method" title="#set_coerce (instance method)">- (RDF::URI, '@id') <strong>set_coerce</strong>(property, value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set term coercion.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_container-instance_method" title="#set_container (instance method)">- (Boolean) <strong>set_container</strong>(property, value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set container mapping.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_language-instance_method" title="#set_language (instance method)">- (String) <strong>set_language</strong>(property, value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set language mapping.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_mapping-instance_method" title="#set_mapping (instance method)">- (RDF::URI, String) <strong>set_mapping</strong>(term, value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set term mapping.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#term_valid%3F-instance_method" title="#term_valid? (instance method)">- (Boolean) <strong>term_valid?</strong>(term) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Determine if <code>term</code> is a suitable term.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Utils.html" title="JSON::LD::Utils (module)">Utils</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Utils.html#annotation%3F-instance_method" title="JSON::LD::Utils#annotation? (method)">#annotation?</a></span>, <span class='object_link'><a href="Utils.html#blank_node%3F-instance_method" title="JSON::LD::Utils#blank_node? (method)">#blank_node?</a></span>, <span class='object_link'><a href="Utils.html#list%3F-instance_method" title="JSON::LD::Utils#list? (method)">#list?</a></span>, <span class='object_link'><a href="Utils.html#node%3F-instance_method" title="JSON::LD::Utils#node? (method)">#node?</a></span>, <span class='object_link'><a href="Utils.html#node_reference%3F-instance_method" title="JSON::LD::Utils#node_reference? (method)">#node_reference?</a></span>, <span class='object_link'><a href="Utils.html#value%3F-instance_method" title="JSON::LD::Utils#value? (method)">#value?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="JSON::LD::EvaluationContext (class)">EvaluationContext</a></span></tt>) <strong>initialize</strong>(options = {}) {|ec| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create new evaluation context</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>ec</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'></span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="JSON::LD::EvaluationContext (class)">EvaluationContext</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 87</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_@base ivar id'>@base</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:base</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:base</span><span class='rbrack token'>]</span>
  <span class='rubyid_@mappings ivar id'>@mappings</span> <span class='assign token'>=</span>  <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_@coercions ivar id'>@coercions</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_@containers ivar id'>@containers</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_@languages ivar id'>@languages</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_@iri_to_curie ivar id'>@iri_to_curie</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_@iri_to_term ivar id'>@iri_to_term</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_to_uri identifier id'>to_uri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;rdf&quot;</span><span class='comma token'>,</span>
    <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XSD constant id'>XSD</span><span class='dot token'>.</span><span class='rubyid_to_uri identifier id'>to_uri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;xsd&quot;</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_@remote_contexts ivar id'>@remote_contexts</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='rubyid_@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span>

  <span class='comment val'># Load any defined prefixes</span>
  <span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:prefixes</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='rubyid_@iri_to_term ivar id'>@iri_to_term</span><span class='lbrack token'>[</span><span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_k identifier id'>k</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_k identifier id'>k</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;init&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;iri_to_term: #{iri_to_term.inspect}&quot;</span><span class='rbrace token'>}</span>
  
  <span class='rubyid_yield yield kw'>yield</span><span class='lparen token'>(</span><span class='rubyid_self self kw'>self</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_block_given? fid id'>block_given?</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="base=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="base-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>) <strong>base</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The base.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Document base IRI, used for expanding relative IRIs.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 13</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_base identifier id'>base</span>
  <span class='rubyid_@base ivar id'>@base</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="coercions=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="coercions-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>coercions</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Type coersion</p>

<p>The @type keyword is used to specify type coersion rules for the data. For each key in the map, the key is a String representation of the property for which String values will be coerced and the value is the datatype (or @id) to coerce to. Type coersion for the value <code>@id</code> asserts that all vocabulary terms listed should undergo coercion to an IRI, including CURIE processing for compact IRI Expressions like <code>foaf:homepage</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 37</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:coercions</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="containers=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="containers-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>containers</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>List coercion</p>

<p>The @container keyword is used to specify how arrays are to be treated. A value of @list indicates that arrays of values are to be treated as an ordered list. A value of @set indicates that arrays are to be treated as unordered and that singular values are always coerced to an array form on expansion and compaction.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 44</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:containers</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="context_base=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="context_base-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>) <strong>context_base</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Base IRI of the context, if loaded remotely.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>base IRI of the context, if loaded remotely.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 17</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:context_base</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_language=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_language-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>default_language</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Default language</p>

<p>This adds a language to plain strings that aren&#39;t otherwise coerced</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 60</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:default_language</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="iri_to_curie=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="iri_to_curie-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>iri_to_curie</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Reverse mappings from IRI to a term or CURIE</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Reverse mappings from IRI to a term or CURIE</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 25</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:iri_to_curie</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="iri_to_term=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="iri_to_term-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>iri_to_term</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Reverse mappings from IRI to term only for terms, not CURIEs</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Reverse mappings from IRI to term only for terms, not CURIEs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 29</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:iri_to_term</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="languages=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="languages-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>languages</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Language coercion</p>

<p>The @language keyword is used to specify language coercion rules for the data. For each key in the map, the key is a String representation of the property for which String values will be coerced and the value is the language to coerce to. If no property-specific language is given, any default language from the context is used.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 52</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:languages</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="mappings=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="mappings-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>) <strong>mappings</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A list of current, in-scope mappings from term to IRI.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span> =&gt; <span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A list of current, in-scope mappings from term to IRI.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 21</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:mappings</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="options=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="options-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>) <strong>options</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Global options used in generating IRIs</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Global options used in generating IRIs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 72</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:options</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="provided_context=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="provided_context-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="JSON::LD::EvaluationContext (class)">EvaluationContext</a></span></tt>) <strong>provided_context</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A context provided to us that we can use without re-serializing</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="JSON::LD::EvaluationContext (class)">EvaluationContext</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A context provided to us that we can use without re-serializing</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 76</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:provided_context</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="remote_contexts=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="remote_contexts-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>&gt;</tt>) <strong>remote_contexts</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The list of remote contexts already processed</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The list of remote contexts already processed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 80</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:remote_contexts</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="vocab=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="vocab-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>vocab</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Default vocabulary</p>

<p>Sets the default vocabulary used for expanding terms which
aren&#39;t otherwise absolute IRIs</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 68</span>

<span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:vocab</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="alias-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>alias</strong>(value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Reverse term mapping, typically used for finding aliases for keys.</p>

<p>Returns either the original value, or a mapping for this value.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><span class='lbrace token'>{</span><span class='string val'>&quot;@context&quot;</span><span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='string val'>&quot;id&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;@id&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='string val'>&quot;@id&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;foo&quot;</span><span class='rbrace token'>}</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='string val'>&quot;id&quot;</span><span class='colon op'>:</span> <span class='string val'>&quot;foo&quot;</span><span class='rbrace token'>}</span>
</pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


414
415</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 414</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_alias alias kw'>alias</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
<span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="coerce-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt>'@id'</tt>) <strong>coerce</strong>(property) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve term coercion</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>in unexpanded form</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt>'@id'</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426
427
428
429</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 424</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='comment val'># Map property, if it's not an RDF::Value</span>
  <span class='comment val'># @type is always is an IRI</span>
  <span class='rubyid_return return kw'>return</span> <span class='string val'>'@id'</span> <span class='rubyid_if if_mod kw'>if</span> <span class='lbrack token'>[</span><span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='string val'>'@type'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='rubyid_@coercions ivar id'>@coercions</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compact_iri-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>compact_iri</strong>(iri, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Compacts an absolute IRI to the shortest matching term or compact IRI</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>iri</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>({})</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">position</span>
          <span class="type">(<tt>:subject</tt>, <tt>:predicate</tt>, <tt>:type</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Useful when determining how to serialize.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:value</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Value, used to select among various maps for the same IRI</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:not_term</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Don&#39;t return a term, but only a CURIE or IRI.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>compacted form of IRI</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://json-ld.org/spec/latest/json-ld-api/#iri-compaction" target="_parent" title="http://json-ld.org/spec/latest/json-ld-api/#iri-compaction">http://json-ld.org/spec/latest/json-ld-api/#iri-compaction</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 577</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_depth identifier id'>depth</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;compact_iri(#{iri.inspect}, #{options.inspect})&quot;</span><span class='rbrace token'>}</span>

    <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:value</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>

    <span class='comment val'># Get a list of terms which map to iri</span>
    <span class='rubyid_matched_terms identifier id'>matched_terms</span> <span class='assign token'>=</span> <span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='eq op'>==</span> <span class='rubyid_iri identifier id'>iri</span><span class='rbrace token'>}</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;compact_iri&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;initial terms: #{matched_terms.inspect}&quot;</span><span class='rparen token'>)</span>

    <span class='comment val'># Create an empty list of terms _terms_ that will be populated with terms that are ranked according to how closely they match value. Initialize highest rank to 0, and set a flag list container to false.</span>
    <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

    <span class='comment val'># If value is a @list select terms that match every item equivalently.</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;compact_iri&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{value.inspect} is a list? #{list?(value).inspect}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_list? fid id'>list?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_annotation? fid id'>annotation?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_list_terms identifier id'>list_terms</span> <span class='assign token'>=</span> <span class='rubyid_matched_terms identifier id'>matched_terms</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@list'</span><span class='rbrace token'>}</span>
        
      <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_list_terms identifier id'>list_terms</span><span class='dot token'>.</span><span class='rubyid_inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_memo identifier id'>memo</span><span class='comma token'>,</span> <span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='rubyid_memo identifier id'>memo</span><span class='lbrack token'>[</span><span class='rubyid_t identifier id'>t</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_term_rank identifier id'>term_rank</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
        <span class='rubyid_memo identifier id'>memo</span>
      <span class='rubyid_end end kw'>end</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_list_terms identifier id'>list_terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;term map&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;remove zero rank terms: #{terms.keys.select {|t| terms[t] == 0}}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rbrace token'>}</span>
      <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span> <span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>
    
    <span class='comment val'># Otherwise, value is @value or a native type.</span>
    <span class='comment val'># Add a term rank for each term mapping to iri</span>
    <span class='comment val'># which does not have @container @list</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_non_list_terms identifier id'>non_list_terms</span> <span class='assign token'>=</span> <span class='rubyid_matched_terms identifier id'>matched_terms</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@list'</span><span class='rbrace token'>}</span>

      <span class='comment val'># If value is a @list, exclude from term map those terms</span>
      <span class='comment val'># with @container @set</span>
      <span class='rubyid_non_list_terms identifier id'>non_list_terms</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@set'</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_list? fid id'>list?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>

      <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_non_list_terms identifier id'>non_list_terms</span><span class='dot token'>.</span><span class='rubyid_inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_memo identifier id'>memo</span><span class='comma token'>,</span> <span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='rubyid_memo identifier id'>memo</span><span class='lbrack token'>[</span><span class='rubyid_t identifier id'>t</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_term_rank identifier id'>term_rank</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
        <span class='rubyid_memo identifier id'>memo</span>
      <span class='rubyid_end end kw'>end</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_non_list_terms identifier id'>non_list_terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;term map&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;remove zero rank terms: #{terms.keys.select {|t| terms[t] == 0}}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rbrace token'>}</span>
      <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span> <span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># If we don't want terms, remove anything that's not a CURIE or IRI</span>
    <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_keep_if identifier id'>keep_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_t identifier id'>t</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:not_term</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>

    <span class='comment val'># Find terms having the greatest term match value</span>
    <span class='rubyid_least_distance identifier id'>least_distance</span> <span class='assign token'>=</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_values identifier id'>values</span><span class='dot token'>.</span><span class='rubyid_max identifier id'>max</span>
    <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_terms identifier id'>terms</span><span class='lbrack token'>[</span><span class='rubyid_t identifier id'>t</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_least_distance identifier id'>least_distance</span><span class='rbrace token'>}</span>

    <span class='comment val'># If terms is empty, add a compact IRI representation of iri for each </span>
    <span class='comment val'># term in the active context which maps to an IRI which is a prefix for </span>
    <span class='comment val'># iri where the resulting compact IRI is not a term in the active </span>
    <span class='comment val'># context. The resulting compact IRI is the term associated with the </span>
    <span class='comment val'># partially matched IRI in the active context concatenated with a colon </span>
    <span class='comment val'># (:) character and the unmatched part of iri.</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;curies&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;mappings: #{mappings.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_curies identifier id'>curies</span> <span class='assign token'>=</span> <span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span>
        <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='dstring node'>&quot;curies[#{k}]&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;#{mapping(k).inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='comment val'>#debug(&quot;curies[#{k}]&quot;) {&quot;#{(mapping(k).to_s.length &gt; 0).inspect}, #{iri.to_s.index(mapping(k).to_s)}&quot;}</span>
        <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{k}:&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span>
          <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='neq op'>!=</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
      <span class='rubyid_end end kw'>end</span><span class='dot token'>.</span><span class='rubyid_compact identifier id'>compact</span>

      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;curies&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
        <span class='rubyid_curies identifier id'>curies</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_c identifier id'>c</span><span class='bitor op'>|</span>
          <span class='dstring node'>&quot;#{c}: &quot;</span> <span class='plus op'>+</span>
          <span class='dstring node'>&quot;container: #{container(c).inspect}, &quot;</span> <span class='plus op'>+</span>
          <span class='dstring node'>&quot;coerce: #{coerce(c).inspect}, &quot;</span> <span class='plus op'>+</span>
          <span class='dstring node'>&quot;lang: #{language(c).inspect}&quot;</span>
        <span class='rubyid_end end kw'>end</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_curies identifier id'>curies</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_curie identifier id'>curie</span><span class='bitor op'>|</span>
        <span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='symbol val'>:predicate</span> <span class='orop op'>||</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_curie identifier id'>curie</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='string val'>'@list'</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
        <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_curie identifier id'>curie</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span>
        <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_curie identifier id'>curie</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='rubyid_default_language identifier id'>default_language</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;curies&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;selected #{terms.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># If terms is empty, and the active context has a @vocab which is a  prefix of iri where the resulting relative IRI is not a term in the  active context. The resulting relative IRI is the unmatched part of iri.</span>
    <span class='comment val'># Don't use vocab, if the result would collide with a term</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_vocab identifier id'>vocab</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='rubyid_vocab identifier id'>vocab</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span>
      <span class='notop op'>!</span><span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='rubyid_vocab identifier id'>vocab</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
       <span class='lbrack token'>[</span><span class='symbol val'>:predicate</span><span class='comma token'>,</span> <span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='rubyid_terms identifier id'>terms</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='rubyid_vocab identifier id'>vocab</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;vocab&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;vocab: #{vocab}, rel: #{terms.first}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># If we still don't have any terms and we're using standard_prefixes,</span>
    <span class='comment val'># try those, and add to mapping</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:standard_prefixes</span><span class='rbrack token'>]</span>
      <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Vocabulary constant id'>Vocabulary</span><span class='dot token'>.</span>
        <span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_to_uri identifier id'>to_uri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rbrace token'>}</span><span class='dot token'>.</span>
        <span class='rubyid_map identifier id'>map</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
          <span class='rubyid_prefix identifier id'>prefix</span> <span class='assign token'>=</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid___name__ identifier id'>__name__</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>'::'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_last identifier id'>last</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span>
          <span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_to_uri identifier id'>to_uri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span>
          <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_to_uri identifier id'>to_uri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{prefix}:&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/:$/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;curies&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;using standard prefies: #{terms.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_if if kw'>if</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='comment val'># If there is a mapping from the complete IRI to null, return null,</span>
      <span class='comment val'># otherwise, return the complete IRI.</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
        <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;iri&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='string val'>&quot;use nil IRI mapping&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_terms identifier id'>terms</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_nil nil kw'>nil</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_terms identifier id'>terms</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Get the first term based on distance and lexecographical order</span>
    <span class='comment val'># Prefer terms that don't have @container @set over other terms, unless as set is true</span>
    <span class='rubyid_terms identifier id'>terms</span> <span class='assign token'>=</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_sort identifier id'>sort</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='comma token'>,</span> <span class='rubyid_b identifier id'>b</span><span class='bitor op'>|</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;term sort&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;c(a): #{container(a).inspect}, c(b): #{container(b)}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eq op'>==</span> <span class='rubyid_b identifier id'>b</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span>
        <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='cmp op'>&lt;=&gt;</span> <span class='rubyid_b identifier id'>b</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='cmp op'>&lt;=&gt;</span> <span class='rubyid_b identifier id'>b</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;sorted terms&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span><span class='rbrace token'>}</span>
    <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_terms identifier id'>terms</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span>

    <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; #{result.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_result identifier id'>result</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compact_value-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>compact_value</strong>(property, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Compact a value</p>

<p>FIXME: revisit the specification version of this.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Associated property used to find coercion rules</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Value (literal or IRI), in full object representation, to be compacted</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Object representation of value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ProcessingError.html" title="JSON::LD::ProcessingError (class)">ProcessingError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if the iri cannot be expanded</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://json-ld.org/spec/latest/json-ld-api/#value-compaction" target="_parent" title="http://json-ld.org/spec/latest/json-ld-api/#value-compaction">http://json-ld.org/spec/latest/json-ld-api/#value-compaction</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 788</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_compact_value identifier id'>compact_value</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ProcessingError constant id'>ProcessingError</span><span class='colon2 op'>::</span><span class='rubyid_Lossy constant id'>Lossy</span><span class='comma token'>,</span> <span class='dstring node'>&quot;attempt to compact a non-object value: #{value.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Hash constant id'>Hash</span><span class='rparen token'>)</span>

  <span class='rubyid_depth identifier id'>depth</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;compact_value&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;property: #{property.inspect}, value: #{value.inspect}, coerce: #{coerce(property).inspect}&quot;</span><span class='rbrace token'>}</span>

    <span class='comment val'># Remove @annotation if property has annotation</span>
    <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>'@annotation'</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@annotation'</span>

    <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'@annotation'</span><span class='rparen token'>)</span>
      <span class='comment val'># Don't compact the value</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@annotation without container @annotation)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@id'</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact an @id coercion</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@id &amp; coerce)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='rparen token'>)</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:type</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact common datatype</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot; (@type &amp; coerce) == #{coerce(property)}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact an IRI</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_alias identifier id'>alias</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='rparen token'>)</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot; (#{self.alias('@id')} =&gt; #{value['@id']})&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@language'</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact language</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot; (@language) == #{language(property).inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='string val'>'@value'</span><span class='comma token'>,</span> <span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact simple literal to string</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@value not string)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_default_language identifier id'>default_language</span>
      <span class='comment val'># Compact simple literal to string</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@value &amp;&amp; !@language &amp;&amp; !@type &amp;&amp; !coerce &amp;&amp; !language)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
      <span class='comment val'># Compact simple literal to string</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@value &amp;&amp; !@language &amp;&amp; !@type &amp;&amp; !coerce &amp;&amp; language(property).false)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span>
      <span class='comment val'># Compact datatype</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (@type)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_alias identifier id'>alias</span><span class='lparen token'>(</span><span class='string val'>'@type'</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:type</span><span class='rparen token'>)</span>
      <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='comment val'># Otherwise, use original value</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (no change)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_end end kw'>end</span>
    
    <span class='comment val'># If the result is an object, tranform keys using any term keyword aliases</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_alias identifier id'>alias</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_k identifier id'>k</span><span class='rbrace token'>}</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='string val'>&quot; (map to key aliases)&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_new_element identifier id'>new_element</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
        <span class='rubyid_new_element identifier id'>new_element</span><span class='lbrack token'>[</span><span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_alias identifier id'>alias</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_v identifier id'>v</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_new_element identifier id'>new_element</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; #{result.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_result identifier id'>result</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="container-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>container</strong>(property) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve container mapping, add it if <code>value</code> is provided</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>in unexpanded form</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


452
453
454
455</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 452</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='string val'>'@set'</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_property identifier id'>property</span> <span class='eq op'>==</span> <span class='string val'>'@graph'</span>
  <span class='rubyid_@containers ivar id'>@containers</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dup-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dup</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 867</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_dup identifier id'>dup</span>
  <span class='comment val'># Also duplicate mappings, coerce and list</span>
  <span class='rubyid_that identifier id'>that</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span>
  <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_super super kw'>super</span>
  <span class='rubyid_ec identifier id'>ec</span><span class='dot token'>.</span><span class='rubyid_instance_eval identifier id'>instance_eval</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_@mappings ivar id'>@mappings</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_@coerceions ivar id'>@coerceions</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_coercions identifier id'>coercions</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_@containers ivar id'>@containers</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_containers identifier id'>containers</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_@languages ivar id'>@languages</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_@default_language ivar id'>@default_language</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_default_language identifier id'>default_language</span>
    <span class='rubyid_@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span>
    <span class='rubyid_@iri_to_term ivar id'>@iri_to_term</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_@iri_to_curie ivar id'>@iri_to_curie</span> <span class='assign token'>=</span> <span class='rubyid_that identifier id'>that</span><span class='dot token'>.</span><span class='rubyid_iri_to_curie identifier id'>iri_to_curie</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_ec identifier id'>ec</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expand_iri-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/Term.html" title="RDF::Term (module)">RDF::Term</a></span></tt>, ...) <strong>expand_iri</strong>(iri, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Expand an IRI. Relative IRIs are expanded against any document base.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>iri</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A keyword, term, prefix:suffix or possibly relative IRI</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">position</span>
          <span class="type">(<tt>:subject</tt>, <tt>:predicate</tt>, <tt>:type</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Useful when determining how to serialize.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">base</span>
          <span class="type">(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.base</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Base IRI to use when expanding relative IRIs.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">path</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../String.html" title="String (class)">String</a></span>&gt;</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>[]</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Array of looked up iris, used to find cycles</p>
</div>
          
        </li>
      
        <li>
          <span class="name">namer</span>
          <span class="type">(<tt><span class='object_link'><a href="BlankNodeNamer.html" title="JSON::LD::BlankNodeNamer (class)">BlankNodeNamer</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Blank Node namer to use for renaming Blank Nodes</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/Term.html" title="RDF::Term (module)">RDF::Term</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>IRI or String, if it&#39;s a keyword, or array of IRI, if it matches
a property generator</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/ReaderError.html" title="RDF::ReaderError (class)">RDF::ReaderError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if the iri cannot be expanded</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://json-ld.org/spec/latest/json-ld-api/#iri-expansion" target="_parent" title="http://json-ld.org/spec/latest/json-ld-api/#iri-expansion">http://json-ld.org/spec/latest/json-ld-api/#iri-expansion</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 521</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_iri identifier id'>iri</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>

  <span class='rubyid_prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='rubyid_suffix identifier id'>suffix</span> <span class='assign token'>=</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='rubyid_unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='rubyid_m identifier id'>m</span> <span class='assign token'>=</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='rubyid_false false kw'>false</span>
    <span class='comment val'># It's an exact match</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;expand_iri&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;match: #{iri.inspect} to #{m.inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:quiet</span><span class='rbrack token'>]</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_m identifier id'>m</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
      <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_Array constant id'>Array</span>
      <span class='comment val'># Return array of IRIs, if it's a property generator</span>
      <span class='rubyid_m identifier id'>m</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_mm identifier id'>mm</span><span class='bitor op'>|</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_mm identifier id'>mm</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_m identifier id'>m</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;expand_iri&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;prefix: #{prefix.inspect}, suffix: #{suffix.inspect}, vocab: #{vocab.inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:quiet</span><span class='rbrack token'>]</span>
  <span class='rubyid_base identifier id'>base</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:subject</span><span class='comma token'>,</span> <span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:base</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_prefix identifier id'>prefix</span> <span class='assign token'>=</span> <span class='rubyid_prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
  <span class='rubyid_case case kw'>case</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_prefix identifier id'>prefix</span> <span class='eq op'>==</span> <span class='string val'>'_'</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_suffix identifier id'>suffix</span>          <span class='rubyid_then then kw'>then</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_bnode identifier id'>bnode</span><span class='lparen token'>(</span><span class='rubyid_suffix identifier id'>suffix</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_iri identifier id'>iri</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;@&quot;</span>             <span class='rubyid_then then kw'>then</span> <span class='rubyid_iri identifier id'>iri</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_suffix identifier id'>suffix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'//'</span>         <span class='rubyid_then then kw'>then</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
  <span class='rubyid_when when kw'>when</span> <span class='lparen token'>(</span><span class='rubyid_mapping identifier id'>mapping</span> <span class='assign token'>=</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_prefix identifier id'>prefix</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;expand_iri&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;mapping: #{mapping(prefix).inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:quiet</span><span class='rbrack token'>]</span>
    <span class='rubyid_case case kw'>case</span> <span class='rubyid_mapping identifier id'>mapping</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_Array constant id'>Array</span>
      <span class='comment val'># Return array of IRIs, if it's a property generator</span>
      <span class='rubyid_mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_m identifier id'>m</span><span class='bitor op'>|</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_m identifier id'>m</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='rubyid_suffix identifier id'>suffix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='rubyid_suffix identifier id'>suffix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_base identifier id'>base</span>                             <span class='rubyid_then then kw'>then</span> <span class='rubyid_base identifier id'>base</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_vocab identifier id'>vocab</span>                            <span class='rubyid_then then kw'>then</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{vocab}#{iri}&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'># Otherwise, it must be an absolute IRI</span>
    <span class='rubyid_u identifier id'>u</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
    <span class='rubyid_u identifier id'>u</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_u identifier id'>u</span><span class='dot token'>.</span><span class='rubyid_absolute? fid id'>absolute?</span> <span class='orop op'>||</span> <span class='lbrack token'>[</span><span class='symbol val'>:subject</span><span class='comma token'>,</span> <span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expand_value-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>expand_value</strong>(property, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Expand a value from compacted to expanded form making the context
unnecessary. This method is used as part of more general expansion
and operates on RHS values, using a supplied key to determine @type and</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Associated property used to find coercion rules</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Value (literal or IRI) to be expanded</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:useNativeTypes</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>use native representations</p>
</div>
          
        </li>
      
        <li>
          <span class="name">namer</span>
          <span class="type">(<tt><span class='object_link'><a href="BlankNodeNamer.html" title="JSON::LD::BlankNodeNamer (class)">BlankNodeNamer</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Blank Node namer to use for renaming Blank Nodes</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Object representation of value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/ReaderError.html" title="RDF::ReaderError (class)">RDF::ReaderError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if the iri cannot be expanded</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://json-ld.org/spec/latest/json-ld-api/#value-expansion" target="_parent" title="http://json-ld.org/spec/latest/json-ld-api/#value-expansion">http://json-ld.org/spec/latest/json-ld-api/#value-expansion</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 732</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_expand_value identifier id'>expand_value</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:useNativeTypes</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_depth identifier id'>depth</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;expand_value&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;property: #{property.inspect}, value: #{value.inspect}, coerce: #{coerce(property).inspect}&quot;</span><span class='rbrace token'>}</span>

    <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Value constant id'>Value</span><span class='rparen token'>)</span>
      <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'@id'</span>
      <span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='comma token'>,</span> <span class='symbol val'>:namer</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;expand_value&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;normalized: #{value.inspect}&quot;</span><span class='rbrace token'>}</span>
    
    <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;URI | BNode&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rbrace token'>}</span>
      <span class='lbrace token'>{</span><span class='string val'>'@id'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrace token'>}</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;Literal&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;datatype: #{value.datatype.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_res identifier id'>res</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:useNativeTypes</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='lbrack token'>[</span><span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XSD constant id'>XSD</span><span class='dot token'>.</span><span class='rubyid_boolean identifier id'>boolean</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XSD constant id'>XSD</span><span class='dot token'>.</span><span class='rubyid_integer identifier id'>integer</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XSD constant id'>XSD</span><span class='dot token'>.</span><span class='rubyid_double identifier id'>double</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_datatype identifier id'>datatype</span><span class='rparen token'>)</span>
        <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_object identifier id'>object</span>
        <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_canonicalize! fid id'>canonicalize!</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XSD constant id'>XSD</span><span class='dot token'>.</span><span class='rubyid_double identifier id'>double</span>
        <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@value'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
          <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_datatype? fid id'>has_datatype?</span>
          <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@type'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_datatype identifier id'>datatype</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:namer</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_language? fid id'>has_language?</span> <span class='orop op'>||</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
          <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span> <span class='orop op'>||</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_res identifier id'>res</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; #{result.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_result identifier id'>result</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>inspect</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


857
858
859
860
861
862
863
864
865</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 857</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_inspect identifier id'>inspect</span>
  <span class='rubyid_v identifier id'>v</span> <span class='assign token'>=</span> <span class='dstring node'>%w([EvaluationContext)</span>
  <span class='rubyid_v identifier id'>v</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;def_language=#{default_language}&quot;</span>
  <span class='rubyid_v identifier id'>v</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;languages[#{languages.keys.length}]=#{languages}&quot;</span>
  <span class='rubyid_v identifier id'>v</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;mappings[#{mappings.keys.length}]=#{mappings}&quot;</span>
  <span class='rubyid_v identifier id'>v</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;coercions[#{coercions.keys.length}]=#{coercions}&quot;</span>
  <span class='rubyid_v identifier id'>v</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;containers[#{containers.length}]=#{containers}&quot;</span>
  <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;]&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="language-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>language</strong>(property) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve the language associated with a property, or the default language otherwise</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


476
477
478</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 476</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='rubyid_@languages ivar id'>@languages</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_@default_language ivar id'>@default_language</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mapping-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>mapping</strong>(term) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve term mapping</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>term</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>#to_s</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 381</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='rparen token'>)</span>
  <span class='rubyid_@mappings ivar id'>@mappings</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse</strong>(context) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create an Evaluation Context using an existing context as a start by parsing the input.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>context</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>#read</tt>, <tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>, <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>, <tt>EvaluatoinContext</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidContext.html" title="JSON::LD::InvalidContext (class)">InvalidContext</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>on a remote context load error, syntax error, or a reference to a term which is not defined.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 117</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='rubyid_case case kw'>case</span> <span class='rubyid_context identifier id'>context</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_EvaluationContext constant id'>EvaluationContext</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_EvaluationContext constant id'>EvaluationContext</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;context: #{context.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_IO constant id'>IO</span><span class='comma token'>,</span> <span class='rubyid_StringIO constant id'>StringIO</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;io: #{context}&quot;</span><span class='rbrace token'>}</span>
    <span class='comment val'># Load context document, if it is a string</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_ctx identifier id'>ctx</span> <span class='assign token'>=</span> <span class='rubyid_JSON constant id'>JSON</span><span class='dot token'>.</span><span class='rubyid_load identifier id'>load</span><span class='lparen token'>(</span><span class='rubyid_context identifier id'>context</span><span class='rparen token'>)</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_JSON constant id'>JSON</span><span class='colon2 op'>::</span><span class='rubyid_LD constant id'>LD</span><span class='colon2 op'>::</span><span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_LoadError constant id'>LoadError</span><span class='comma token'>,</span> <span class='string val'>&quot;Context missing @context key&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>'@context'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
      <span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>&quot;@context&quot;</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_JSON constant id'>JSON</span><span class='colon2 op'>::</span><span class='rubyid_ParserError constant id'>ParserError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Failed to parse @context from remote document at #{context}: #{e.message}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_JSON constant id'>JSON</span><span class='colon2 op'>::</span><span class='rubyid_LD constant id'>LD</span><span class='colon2 op'>::</span><span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Failed to parse remote context at #{context}: #{e.message}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span>
      <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='string val'>&quot;nil&quot;</span><span class='rbrace token'>}</span>
    <span class='comment val'># Load context document, if it is a string</span>
    <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_EvaluationContext constant id'>EvaluationContext</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_String constant id'>String</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;remote: #{context}, base: #{context_base || base}&quot;</span><span class='rbrace token'>}</span>
    <span class='comment val'># Load context document, if it is a string</span>
    <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_url identifier id'>url</span> <span class='assign token'>=</span> <span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_context identifier id'>context</span><span class='comma token'>,</span> <span class='symbol val'>:base</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_context_base identifier id'>context_base</span> <span class='orop op'>||</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='rparen token'>)</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_JSON constant id'>JSON</span><span class='colon2 op'>::</span><span class='rubyid_LD constant id'>LD</span><span class='colon2 op'>::</span><span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_LoadError constant id'>LoadError</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_remote_contexts identifier id'>remote_contexts</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_url identifier id'>url</span><span class='rparen token'>)</span>
      <span class='rubyid_@remote_contexts ivar id'>@remote_contexts</span> <span class='assign token'>=</span> <span class='rubyid_@remote_contexts ivar id'>@remote_contexts</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='rubyid_url identifier id'>url</span><span class='rbrack token'>]</span>
      <span class='rubyid_ecdup identifier id'>ecdup</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
      <span class='rubyid_ecdup identifier id'>ecdup</span><span class='dot token'>.</span><span class='rubyid_context_base identifier id'>context_base</span> <span class='assign token'>=</span> <span class='rubyid_url identifier id'>url</span>  <span class='comment val'># Set context_base for recursive remote contexts</span>
      <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Util constant id'>Util</span><span class='colon2 op'>::</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open_file identifier id'>open_file</span><span class='lparen token'>(</span><span class='rubyid_url identifier id'>url</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_ecdup identifier id'>ecdup</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_f identifier id'>f</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
      <span class='rubyid_ec identifier id'>ec</span><span class='dot token'>.</span><span class='rubyid_provided_context identifier id'>provided_context</span> <span class='assign token'>=</span> <span class='rubyid_context identifier id'>context</span>
      <span class='rubyid_ec identifier id'>ec</span><span class='dot token'>.</span><span class='rubyid_context_base identifier id'>context_base</span> <span class='assign token'>=</span> <span class='rubyid_url identifier id'>url</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; provided_context: #{context.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_ec identifier id'>ec</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Failed to retrieve @context from remote document at #{context.inspect}: #{e.message}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_JSON constant id'>JSON</span><span class='colon2 op'>::</span><span class='rubyid_LD constant id'>LD</span><span class='colon2 op'>::</span><span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_LoadError constant id'>LoadError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Failed to retrieve remote context at #{context.inspect}: #{e.message}&quot;</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_backtrace identifier id'>backtrace</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span>
      <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_Array constant id'>Array</span>
    <span class='comment val'># Process each member of the array in order, updating the active context</span>
    <span class='comment val'># Updates evaluation context serially during parsing</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='string val'>&quot;Array&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span>
    <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_c identifier id'>c</span><span class='bitor op'>|</span> <span class='rubyid_ec identifier id'>ec</span> <span class='assign token'>=</span> <span class='rubyid_ec identifier id'>ec</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_c identifier id'>c</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='rubyid_ec identifier id'>ec</span><span class='dot token'>.</span><span class='rubyid_provided_context identifier id'>provided_context</span> <span class='assign token'>=</span> <span class='rubyid_context identifier id'>context</span>
    <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; provided_context: #{context.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_ec identifier id'>ec</span>
  <span class='rubyid_when when kw'>when</span> <span class='rubyid_Hash constant id'>Hash</span>
    <span class='rubyid_new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
    <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_provided_context identifier id'>provided_context</span> <span class='assign token'>=</span> <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>

    <span class='comment val'># If context has a @vocab member: if its value is not a valid absolute IRI or null trigger an INVALID_VOCAB_MAPPING error; otherwise set the active context's vocabulary mapping to its value and remove the @vocab member from context.</span>
    <span class='lbrace token'>{</span>
      <span class='string val'>'@language'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:default_language=</span><span class='comma token'>,</span>
      <span class='string val'>'@vocab'</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:vocab=</span>
    <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_setter identifier id'>setter</span><span class='bitor op'>|</span>
      <span class='rubyid_v identifier id'>v</span> <span class='assign token'>=</span> <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
        <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
        <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Set #{key} to #{v.inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_send identifier id'>send</span><span class='lparen token'>(</span><span class='rubyid_setter identifier id'>setter</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_v identifier id'>v</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{key.inspect} is invalid&quot;</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_num_updates identifier id'>num_updates</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='rubyid_while while kw'>while</span> <span class='rubyid_num_updates identifier id'>num_updates</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_num_updates identifier id'>num_updates</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

      <span class='comment val'># Map terms to IRIs/keywords first</span>
      <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='comment val'># Expand a string value, unless it matches a keyword</span>
        <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Hash[#{key}] = #{value.inspect}&quot;</span><span class='rbrace token'>}</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_KEYWORDS constant id'>KEYWORDS</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
          <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;key #{key.inspect} must not be a keyword&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span>
          <span class='rubyid_next next kw'>next</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_term_valid? fid id'>term_valid?</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
          <span class='comment val'># Remove all coercion information for the property</span>
          <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_coerce identifier id'>set_coerce</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
          <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_container identifier id'>set_container</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
          <span class='rubyid_@languages ivar id'>@languages</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>

          <span class='comment val'># Extract IRI mapping. This is complicated, as @id may have been aliased. Also, if @id is explicitly set to nil, it inhibits and automatic mapping, so treat it as false, to distinguish from no mapping at all.</span>
          <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_value identifier id'>value</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_Hash constant id'>Hash</span>
            <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_value identifier id'>value</span><span class='lbrack token'>[</span><span class='string val'>'@id'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='rubyid_false false kw'>false</span> <span class='colon op'>:</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
            <span class='rubyid_false false kw'>false</span>
          <span class='rubyid_else else kw'>else</span>
            <span class='rubyid_value identifier id'>value</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='comment val'># Explicitly say this is not mapped</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span> <span class='eq op'>==</span> <span class='rubyid_false false kw'>false</span>
            <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Map #{key} to nil&quot;</span><span class='rbrace token'>}</span>
            <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
            <span class='rubyid_next next kw'>next</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_iri identifier id'>iri</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span>
            <span class='comment val'># expand each item according the IRI Expansion algorithm. If an item does not expand to a valid absolute IRI, raise an INVALID_PROPERTY_GENERATOR error; otherwise sort val and store it as IRI mapping in definition.</span>
            <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
              <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unknown mapping for #{key.inspect} to #{v.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
              <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:predicate</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span><span class='dot token'>.</span><span class='rubyid_sort identifier id'>sort</span>
          <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_value identifier id'>value</span>
            <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unknown mapping for #{key.inspect} to #{value.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
            <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:predicate</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_if if kw'>if</span> <span class='rubyid_iri identifier id'>iri</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_iri identifier id'>iri</span>
            <span class='comment val'># Record term definition</span>
            <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
            <span class='rubyid_num_updates identifier id'>num_updates</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:validate</span><span class='rbrack token'>]</span>
          <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;key #{key.inspect} is invalid&quot;</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Next, look for coercion using new_ec</span>
    <span class='rubyid_context identifier id'>context</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
      <span class='comment val'># Expand a string value, unless it matches a keyword</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;coercion/list: Hash[#{key}] = #{value.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_case case kw'>case</span> <span class='rubyid_value identifier id'>value</span>
      <span class='rubyid_when when kw'>when</span> <span class='rubyid_Hash constant id'>Hash</span>
        <span class='comment val'># Must have one of @id, @language, @type or @container</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;mapping for #{key.inspect} missing one of @id, @language, @type or @container&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='dstring node'>%w(@id @language @type @container)</span> <span class='bitand op'>&amp;</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key2 identifier id'>key2</span><span class='comma token'>,</span> <span class='rubyid_value2 identifier id'>value2</span><span class='bitor op'>|</span>
          <span class='rubyid_iri identifier id'>iri</span> <span class='assign token'>=</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_value2 identifier id'>value2</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:predicate</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value2 identifier id'>value2</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
          <span class='rubyid_case case kw'>case</span> <span class='rubyid_key2 identifier id'>key2</span>
          <span class='rubyid_when when kw'>when</span> <span class='string val'>'@type'</span>
            <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unknown mapping for '@type' to #{value2.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_value2 identifier id'>value2</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_value2 identifier id'>value2</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_iri identifier id'>iri</span>
              <span class='rubyid_case case kw'>case</span> <span class='rubyid_iri identifier id'>iri</span>
              <span class='rubyid_when when kw'>when</span> <span class='string val'>'@id'</span><span class='comma token'>,</span> <span class='regexp val'>/_:/</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span>
              <span class='rubyid_else else kw'>else</span>
                <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unknown mapping for '@type' to #{iri.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='lparen token'>(</span><span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_absolute? fid id'>absolute?</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
              <span class='rubyid_end end kw'>end</span>
              <span class='comment val'># Record term coercion</span>
              <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_coerce identifier id'>set_coerce</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_when when kw'>when</span> <span class='string val'>'@container'</span>
            <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unknown mapping for '@container' to #{value2.inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='dstring node'>%w(@list @set @language @annotation)</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_value2 identifier id'>value2</span><span class='rparen token'>)</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_value2 identifier id'>value2</span>
              <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;container #{key.inspect} as #{value2.inspect}&quot;</span><span class='rbrace token'>}</span>
              <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_container identifier id'>set_container</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value2 identifier id'>value2</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_when when kw'>when</span> <span class='string val'>'@language'</span>
            <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_languages identifier id'>languages</span><span class='lbrack token'>[</span><span class='rubyid_key identifier id'>key</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='rubyid_value2 identifier id'>value2</span>
              <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;parse&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;language #{key.inspect} as #{value2.inspect}&quot;</span><span class='rbrace token'>}</span>
              <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_language identifier id'>set_language</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value2 identifier id'>value2</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
      
        <span class='comment val'># If value has no @id, create a mapping from key</span>
        <span class='comment val'># to the expanded key IRI</span>
        <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'@id'</span><span class='rparen token'>)</span>
          <span class='rubyid_iri identifier id'>iri</span> <span class='assign token'>=</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_expand_iri identifier id'>expand_iri</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:predicate</span><span class='rparen token'>)</span>
          <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_iri identifier id'>iri</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_String constant id'>String</span>
        <span class='comment val'># handled in previous loop</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_InvalidContext constant id'>InvalidContext</span><span class='colon2 op'>::</span><span class='rubyid_Syntax constant id'>Syntax</span><span class='comma token'>,</span> <span class='dstring node'>&quot;attempt to map #{key.inspect} to #{value.class}&quot;</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_new_ec identifier id'>new_ec</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Generate @context</span>
<span class='comment val'>#</span>
<span class='comment val'># If a context was supplied in global options, use that, otherwise, generate one</span>
<span class='comment val'># from this representation.</span>
<span class='comment val'>#</span>
<span class='comment val'># @param  [Hash{Symbol =&gt; Object}] options ({})</span>
<span class='comment val'># @return [Hash]</span>
<span class='rubyid_def def kw'>def</span> <span class='rubyid_serialize identifier id'>serialize</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_depth identifier id'>depth</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_use_context identifier id'>use_context</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_provided_context identifier id'>provided_context</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;serlialize: reuse context: #{provided_context.inspect}&quot;</span>
      <span class='rubyid_provided_context identifier id'>provided_context</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;serlialize: generate context&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; context: #{inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_ctx identifier id'>ctx</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
      <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_default_language identifier id'>default_language</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_default_language identifier id'>default_language</span>
      <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>'@vocab'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_vocab identifier id'>vocab</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_vocab identifier id'>vocab</span>

      <span class='comment val'># Mappings</span>
      <span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_kw_sort identifier id'>kw_sort</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='comma token'>,</span> <span class='rubyid_b identifier id'>b</span><span class='bitor op'>|</span> <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='cmp op'>&lt;=&gt;</span> <span class='rubyid_b identifier id'>b</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span>
        <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_term_valid? fid id'>term_valid?</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span>
        <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; mappings[#{k}] =&gt; #{mappings[k]}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_mappings identifier id'>mappings</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_coercions identifier id'>coercions</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_containers identifier id'>containers</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='comment val'># Coerce</span>
        <span class='lparen token'>(</span><span class='rubyid_coercions identifier id'>coercions</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span> <span class='plus op'>+</span> <span class='rubyid_containers identifier id'>containers</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span> <span class='plus op'>+</span> <span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='rubyid_sort identifier id'>sort</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span>
          <span class='rubyid_next next kw'>next</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_k identifier id'>k</span> <span class='eq op'>==</span> <span class='string val'>'@type'</span>

          <span class='comment val'># Turn into long form</span>
          <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
            <span class='rubyid_defn identifier id'>defn</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
            <span class='rubyid_defn identifier id'>defn</span><span class='lbrack token'>[</span><span class='string val'>&quot;@id&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='comma token'>,</span> <span class='symbol val'>:not_term</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_defn identifier id'>defn</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; coerce(#{k}) =&gt; #{coerce(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_NATIVE_DATATYPES constant id'>NATIVE_DATATYPES</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='rubyid_dt identifier id'>dt</span> <span class='assign token'>=</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span>
            <span class='rubyid_dt identifier id'>dt</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_dt identifier id'>dt</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:type</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_dt identifier id'>dt</span> <span class='eq op'>==</span> <span class='string val'>'@id'</span>
            <span class='comment val'># Fold into existing definition</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@type&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_dt identifier id'>dt</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; datatype[#{k}] =&gt; #{dt}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; container(#{k}) =&gt; #{container(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='dstring node'>%w(@list @set @language @annotation)</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@container&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; container[#{k}] =&gt; #{container(k).inspect}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; language(#{k}) =&gt; #{language(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_default_language identifier id'>default_language</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@language&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='rubyid_nil nil kw'>nil</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; language[#{k}] =&gt; #{language(k).inspect}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>
          
          <span class='comment val'># Remove an empty definition</span>
          <span class='rubyid_ctx identifier id'>ctx</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;start_doc: context=#{ctx.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_ctx identifier id'>ctx</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Return hash with @context, or empty</span>
    <span class='rubyid_r identifier id'>r</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
    <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'@context'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_use_context identifier id'>use_context</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_use_context identifier id'>use_context</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='rubyid_use_context identifier id'>use_context</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='rubyid_r identifier id'>r</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Retrieve term mapping</span>
<span class='comment val'>#</span>
<span class='comment val'># @param [String, #to_s] term</span>
<span class='comment val'>#</span>
<span class='comment val'># @return [RDF::URI, String]</span>
<span class='rubyid_def def kw'>def</span> <span class='rubyid_mapping identifier id'>mapping</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='rparen token'>)</span>
  <span class='rubyid_@mappings ivar id'>@mappings</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Set term mapping</span>
<span class='comment val'>#</span>
<span class='comment val'># @param [#to_s] term</span>
<span class='comment val'># @param [RDF::URI, String, nil] value</span>
<span class='comment val'>#</span>
<span class='comment val'># @return [RDF::URI, String]</span>
<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_term identifier id'>term</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
  <span class='rubyid_term_sym identifier id'>term_sym</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='string val'>&quot;&quot;</span> <span class='colon op'>:</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span>
<span class='comment val'>#      raise InvalidContext::Syntax, &quot;mapping term #{term.inspect} must be a string&quot; unless term.is_a?(String)</span>
<span class='comment val'>#      raise InvalidContext::Syntax, &quot;mapping value #{value.inspect} must be an RDF::URI&quot; unless value.nil? || value.to_s[0,1] == '@' || value.is_a?(RDF::URI)</span>
  <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;map #{term.inspect} to #{value.inspect}&quot;</span><span class='rbrace token'>}</span>
  <span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span>
  <span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:prefixes</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_term_sym identifier id'>term_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:prefixes</span><span class='rparen token'>)</span>
  <span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='lbrack token'>[</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span>
<span class='rubyid_end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Reverse term mapping, typically used for finding aliases for keys.</span>
<span class='comment val'>#</span>
<span class='comment val'># Returns either the original value, or a mapping for this value.</span>
<span class='comment val'>#</span>
<span class='comment val'># @example</span>
<span class='comment val'>#   {&quot;@context&quot;: {&quot;id&quot;: &quot;@id&quot;}, &quot;@id&quot;: &quot;foo&quot;} =&gt; {&quot;id&quot;: &quot;foo&quot;}</span>
<span class='comment val'>#</span>
<span class='comment val'># @param [RDF::URI, String] value</span>
<span class='comment val'># @return [String]</span>
<span class='rubyid_def def kw'>def</span> <span class='rubyid_alias alias kw'>alias</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="serialize-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>serialize</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate @context</p>

<p>If a context was supplied in global options, use that, otherwise, generate one
from this representation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>({})</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 306</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_serialize identifier id'>serialize</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_depth identifier id'>depth</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_use_context identifier id'>use_context</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_provided_context identifier id'>provided_context</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;serlialize: reuse context: #{provided_context.inspect}&quot;</span>
      <span class='rubyid_provided_context identifier id'>provided_context</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_debug identifier id'>debug</span><span class='lparen token'>(</span><span class='string val'>&quot;serlialize: generate context&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; context: #{inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_ctx identifier id'>ctx</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
      <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>'@language'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_default_language identifier id'>default_language</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_default_language identifier id'>default_language</span>
      <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='string val'>'@vocab'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_vocab identifier id'>vocab</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_vocab identifier id'>vocab</span>

      <span class='comment val'># Mappings</span>
      <span class='rubyid_mappings identifier id'>mappings</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_kw_sort identifier id'>kw_sort</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='comma token'>,</span> <span class='rubyid_b identifier id'>b</span><span class='bitor op'>|</span> <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='cmp op'>&lt;=&gt;</span> <span class='rubyid_b identifier id'>b</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span>
        <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_term_valid? fid id'>term_valid?</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span>
        <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; mappings[#{k}] =&gt; #{mappings[k]}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_mappings identifier id'>mappings</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_coercions identifier id'>coercions</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_containers identifier id'>containers</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='comment val'># Coerce</span>
        <span class='lparen token'>(</span><span class='rubyid_coercions identifier id'>coercions</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span> <span class='plus op'>+</span> <span class='rubyid_containers identifier id'>containers</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span> <span class='plus op'>+</span> <span class='rubyid_languages identifier id'>languages</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='rubyid_sort identifier id'>sort</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span>
          <span class='rubyid_next next kw'>next</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_k identifier id'>k</span> <span class='eq op'>==</span> <span class='string val'>'@type'</span>

          <span class='comment val'># Turn into long form</span>
          <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
            <span class='rubyid_defn identifier id'>defn</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
            <span class='rubyid_defn identifier id'>defn</span><span class='lbrack token'>[</span><span class='string val'>&quot;@id&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:subject</span><span class='comma token'>,</span> <span class='symbol val'>:not_term</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_defn identifier id'>defn</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; coerce(#{k}) =&gt; #{coerce(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_NATIVE_DATATYPES constant id'>NATIVE_DATATYPES</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='rubyid_dt identifier id'>dt</span> <span class='assign token'>=</span> <span class='rubyid_coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span>
            <span class='rubyid_dt identifier id'>dt</span> <span class='assign token'>=</span> <span class='rubyid_compact_iri identifier id'>compact_iri</span><span class='lparen token'>(</span><span class='rubyid_dt identifier id'>dt</span><span class='comma token'>,</span> <span class='symbol val'>:position</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:type</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_dt identifier id'>dt</span> <span class='eq op'>==</span> <span class='string val'>'@id'</span>
            <span class='comment val'># Fold into existing definition</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@type&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_dt identifier id'>dt</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; datatype[#{k}] =&gt; #{dt}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; container(#{k}) =&gt; #{container(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='dstring node'>%w(@list @set @language @annotation)</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@container&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_container identifier id'>container</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; container[#{k}] =&gt; #{container(k).inspect}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; language(#{k}) =&gt; #{language(k)}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='rubyid_default_language identifier id'>default_language</span>
            <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;@language&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_language identifier id'>language</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='rubyid_nil nil kw'>nil</span>
            <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;=&gt; language[#{k}] =&gt; #{language(k).inspect}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>
          
          <span class='comment val'># Remove an empty definition</span>
          <span class='rubyid_ctx identifier id'>ctx</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_ctx identifier id'>ctx</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;start_doc: context=#{ctx.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_ctx identifier id'>ctx</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Return hash with @context, or empty</span>
    <span class='rubyid_r identifier id'>r</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_ordered identifier id'>ordered</span>
    <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'@context'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_use_context identifier id'>use_context</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_use_context identifier id'>use_context</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='rubyid_use_context identifier id'>use_context</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='rubyid_r identifier id'>r</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_coerce-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt>'@id'</tt>) <strong>set_coerce</strong>(property, value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set term coercion</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>in unexpanded form</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt>'@id'</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt>'@id'</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440
441
442
443
444
445</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 438</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_coerce identifier id'>set_coerce</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;coerce #{property.inspect} to #{value.inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_@coercions ivar id'>@coercions</span><span class='lbrack token'>[</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_@coercions ivar id'>@coercions</span><span class='lbrack token'>[</span><span class='rubyid_property identifier id'>property</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_@coercions ivar id'>@coercions</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_container-instance_method">
  
    - (<tt>Boolean</tt>) <strong>set_container</strong>(property, value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set container mapping</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>one of @list, @set or nil</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


463
464
465
466
467
468
469
470
471</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 463</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_container identifier id'>set_container</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@containers ivar id'>@containers</span><span class='lbrack token'>[</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;coerce #{property.inspect} to #{value.inspect}&quot;</span><span class='rbrace token'>}</span> 
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span>
    <span class='rubyid_@containers ivar id'>@containers</span><span class='lbrack token'>[</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_@containers ivar id'>@containers</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_language-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>set_language</strong>(property, value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set language mapping</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>property</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


486
487
488
489</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 486</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_language identifier id'>set_language</span><span class='lparen token'>(</span><span class='rubyid_property identifier id'>property</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='comment val'># Use false for nil language</span>
  <span class='rubyid_@languages ivar id'>@languages</span><span class='lbrack token'>[</span><span class='rubyid_property identifier id'>property</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span> <span class='integer val'>? </span><span class='rubyid_value identifier id'>value</span> <span class='colon op'>:</span> <span class='rubyid_false false kw'>false</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_mapping-instance_method">
  
    - (<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>set_mapping</strong>(term, value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set term mapping</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>term</span>
      
      
        <span class='type'>(<tt>#to_s</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../RDF/URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


392
393
394
395
396
397
398
399
400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 392</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_mapping identifier id'>set_mapping</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_term identifier id'>term</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
  <span class='rubyid_term_sym identifier id'>term_sym</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='string val'>&quot;&quot;</span> <span class='colon op'>:</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span>
<span class='comment val'>#      raise InvalidContext::Syntax, &quot;mapping term #{term.inspect} must be a string&quot; unless term.is_a?(String)</span>
<span class='comment val'>#      raise InvalidContext::Syntax, &quot;mapping value #{value.inspect} must be an RDF::URI&quot; unless value.nil? || value.to_s[0,1] == '@' || value.is_a?(RDF::URI)</span>
  <span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;map #{term.inspect} to #{value.inspect}&quot;</span><span class='rbrace token'>}</span>
  <span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span>
  <span class='rubyid_@mappings ivar id'>@mappings</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:prefixes</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_term_sym identifier id'>term_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:prefixes</span><span class='rparen token'>)</span>
  <span class='rubyid_iri_to_term identifier id'>iri_to_term</span><span class='lbrack token'>[</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_term identifier id'>term</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="term_valid?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>term_valid?</strong>(term) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Determine if <code>term</code> is a suitable term.
Term may be any valid JSON string.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>term</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


497
498
499</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/json-ld-3eb8b24c72e3/lib/json/ld/evaluation_context.rb', line 497</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_term_valid? fid id'>term_valid?</span><span class='lparen token'>(</span><span class='rubyid_term identifier id'>term</span><span class='rparen token'>)</span>
  <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_String constant id'>String</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Jan 21 10:31:38 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.8.7).
</div>

  </body>
</html>