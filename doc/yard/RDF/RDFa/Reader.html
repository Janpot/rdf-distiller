<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: RDF::RDFa::Reader
  
    &mdash; Web portal for RDF.rb.
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../RDF.html" title="RDF (module)">RDF</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../RDFa.html" title="RDF::RDFa (module)">RDFa</a></span></span>
     &raquo; 
    <span class="title">Reader</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: RDF::RDFa::Reader
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Reader.html" title="RDF::Reader (class)">RDF::Reader</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../Reader.html" title="RDF::Reader (class)">RDF::Reader</a></span></li>
          
            <li class="next">RDF::RDFa::Reader</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Expansion.html" title="RDF::RDFa::Expansion (module)">Expansion</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb<span class="defines">,<br />
  vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader/nokogiri.rb,<br /> vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader/rexml.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>An RDFa parser in Ruby</p>

<p>This class supports <a href="http://nokogiri.org/">Nokogiri</a> for HTML
processing, and will automatically select the most performant
implementation (Nokogiri or LibXML) that is available. If need be, you
can explicitly override the used implementation by passing in a
<code>:library</code> option to <code>Reader.new</code> or <code>Reader.open</code>.</p>

<p>Based on processing rules described here:</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/rdfa-syntax/#s_model" target="_parent" title="RDFa 1.0">RDFa 1.0</a></li>
    
      <li><a href="http://www.w3.org/TR/2012/REC-rdfa-core-20120607/" target="_parent" title="http://www.w3.org/TR/2012/REC-rdfa-core-20120607/">http://www.w3.org/TR/2012/REC-rdfa-core-20120607/</a></li>
    
      <li><a href="http://www.w3.org/TR/2012/CR-xhtml-rdfa-20120313/" target="_parent" title="http://www.w3.org/TR/2012/CR-xhtml-rdfa-20120313/">http://www.w3.org/TR/2012/CR-xhtml-rdfa-20120313/</a></li>
    
      <li><a href="http://dev.w3.org/html5/rdfa/" target="_parent" title="http://dev.w3.org/html5/rdfa/">http://dev.w3.org/html5/rdfa/</a></li>
    
  </ul>
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><a href="http://kellogg-assoc.com/">Gregg Kellogg</a></p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Reader/Nokogiri.html" title="RDF::RDFa::Reader::Nokogiri (module)">Nokogiri</a></span>, <span class='object_link'><a href="Reader/REXML.html" title="RDF::RDFa::Reader::REXML (module)">REXML</a></span>
    
  
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="XHTML-constant" class="">XHTML =
          
        </dt>
        <dd><pre class="code"><span class='string val'>&quot;http://www.w3.org/1999/xhtml&quot;</span>
</pre></dd>
      
        <dt id="SafeCURIEorCURIEorIRI-constant" class="">SafeCURIEorCURIEorIRI =
          <div class="docstring">
  <div class="discussion">
    <p>Content model for @about and @resource. In RDFa 1.0, this was URIorSafeCURIE</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:safe_curie</span><span class='comma token'>,</span> <span class='symbol val'>:uri</span><span class='comma token'>,</span> <span class='symbol val'>:bnode</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:safe_curie</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='comma token'>,</span> <span class='symbol val'>:uri</span><span class='comma token'>,</span> <span class='symbol val'>:bnode</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="TERMorCURIEorAbsIRI-constant" class="">TERMorCURIEorAbsIRI =
          <div class="docstring">
  <div class="discussion">
    <p>Content model for @datatype. In RDFa 1.0, this was CURIE
Also plural TERMorCURIEorAbsIRIs, content model for @rel, @rev, @property and @typeof</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='comma token'>,</span> <span class='symbol val'>:absuri</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="NC_REGEXP-constant" class="">NC_REGEXP =
          <div class="docstring">
  <div class="discussion">
    <p>This expression matches an NCName as defined in
<a href="http://www.w3.org/TR/2009/REC-xml-names-20091208/#NT-NCName">XML-NAMES</a></p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/2009/REC-xml-names-20091208/#NT-NCName" target="_parent" title="http://www.w3.org/TR/2009/REC-xml-names-20091208/#NT-NCName">http://www.w3.org/TR/2009/REC-xml-names-20091208/#NT-NCName</a></li>
    
  </ul>

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_Regexp constant id'>Regexp</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
<span class='string val'>%{^
  (  [a-zA-Z_]
   | \\\\u[0-9a-fA-F]{4}
  )
  (  [0-9a-zA-Z_\.-/]
   | \\\\u([0-9a-fA-F]{4})
  )*
$}</span><span class='comma token'>,</span>
<span class='rubyid_Regexp constant id'>Regexp</span><span class='colon2 op'>::</span><span class='rubyid_EXTENDED constant id'>EXTENDED</span><span class='rparen token'>)</span>
</pre></dd>
      
        <dt id="TERM_REGEXP-constant" class="">TERM_REGEXP =
          <div class="docstring">
  <div class="discussion">
    <p>This expression matches an term as defined in
<a href="http://www.w3.org/TR/2012/REC-rdfa-core-20120607/#s_terms">RDFA-CORE</a></p>

<p>For the avoidance of doubt, this definition means a &#39;term&#39;
in RDFa is an XML NCName that also permits slash as a non-leading character.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/2012/REC-rdfa-core-20120607/#s_terms" target="_parent" title="http://www.w3.org/TR/2012/REC-rdfa-core-20120607/#s_terms">http://www.w3.org/TR/2012/REC-rdfa-core-20120607/#s_terms</a></li>
    
  </ul>

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_Regexp constant id'>Regexp</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
<span class='string val'>%{^
  (?!\\\\u0301)             # &amp;#x301; is a non-spacing acute accent.
                            # It is legal within an XML Name, but not as the first character.
  (  [a-zA-Z_]
   | \\\\u[0-9a-fA-F]{4}
  )
  (  [0-9a-zA-Z_\.-\/]
   | \\\\u([0-9a-fA-F]{4})
  )*
$}</span><span class='comma token'>,</span>
<span class='rubyid_Regexp constant id'>Regexp</span><span class='colon2 op'>::</span><span class='rubyid_EXTENDED constant id'>EXTENDED</span><span class='rparen token'>)</span>
</pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Expansion.html" title="RDF::RDFa::Expansion (module)">Expansion</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Expansion.html#COOKED_VOCAB_STATEMENTS-constant" title="RDF::RDFa::Expansion::COOKED_VOCAB_STATEMENTS (constant)">Expansion::COOKED_VOCAB_STATEMENTS</a></span></p>


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#host_language-instance_method" title="#host_language (instance method)">- (:xml, ...) <strong>host_language</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Host language.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#implementation-instance_method" title="#implementation (instance method)">- (Module) <strong>implementation</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the XML implementation module for this reader instance.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#repository-instance_method" title="#repository (instance method)">- (RDF::Repository) <strong>repository</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Repository used for collecting triples.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">- (:&quot;rdfa1.0&quot;, :&quot;rdfa1.1&quot;) <strong>version</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Version.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="../Reader.html" title="RDF::Reader (class)">RDF::Reader</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Reader.html#options-instance_method" title="RDF::Reader#options (method)">#options</a></span></p>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#curie_to_resource_or_bnode-instance_method" title="#curie_to_resource_or_bnode (instance method)">- (Object) <strong>curie_to_resource_or_bnode</strong>(element, curie, uri_mappings, subject, restrictions) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>From section 6.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_statement-instance_method" title="#each_statement (instance method)">- <strong>each_statement</strong> {|statement| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Iterates the given block for each RDF statement in the input.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_triple-instance_method" title="#each_triple (instance method)">- <strong>each_triple</strong> {|subject, predicate, object| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Iterates the given block for each RDF triple in the input.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (reader) <strong>initialize</strong>(input = $stdin, options = {}) {|reader| ... }</a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initializes the RDFa reader instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_term-instance_method" title="#process_term (instance method)">- (Object) <strong>process_term</strong>(element, value, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>[7.4.3] General Use of Terms in Attributes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uri-instance_method" title="#process_uri (instance method)">- (Object) <strong>process_uri</strong>(element, value, evaluation_context, base, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uris-instance_method" title="#process_uris (instance method)">- (Object) <strong>process_uris</strong>(element, value, evaluation_context, base, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>space-separated TERMorCURIEorAbsIRI or SafeCURIEorCURIEorIRI.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#traverse-instance_method" title="#traverse (instance method)">- (Object) <strong>traverse</strong>(element, evaluation_context) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The recursive helper function.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#uri-instance_method" title="#uri (instance method)">- (Object) <strong>uri</strong>(value, append = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Expansion.html" title="RDF::RDFa::Expansion (module)">Expansion</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Expansion.html#copy_properties-instance_method" title="RDF::RDFa::Expansion#copy_properties (method)">#copy_properties</a></span>, <span class='object_link'><a href="Expansion.html#expand-instance_method" title="RDF::RDFa::Expansion#expand (method)">#expand</a></span>, <span class='object_link'><a href="Expansion.html#rule-instance_method" title="RDF::RDFa::Expansion#rule (method)">#rule</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Reader.html" title="RDF::Reader (class)">RDF::Reader</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Reader.html#base_uri-instance_method" title="RDF::Reader#base_uri (method)">#base_uri</a></span>, <span class='object_link'><a href="../Reader.html#canonicalize%3F-instance_method" title="RDF::Reader#canonicalize? (method)">#canonicalize?</a></span>, <span class='object_link'><a href="../Reader.html#close-instance_method" title="RDF::Reader#close (method)">#close</a></span>, <span class='object_link'><a href="../Reader.html#each-class_method" title="RDF::Reader.each (method)">each</a></span>, <span class='object_link'><a href="../Reader.html#encoding-instance_method" title="RDF::Reader#encoding (method)">#encoding</a></span>, <span class='object_link'><a href="../Reader.html#fail_object-instance_method" title="RDF::Reader#fail_object (method)">#fail_object</a></span>, <span class='object_link'><a href="../Reader.html#fail_predicate-instance_method" title="RDF::Reader#fail_predicate (method)">#fail_predicate</a></span>, <span class='object_link'><a href="../Reader.html#fail_subject-instance_method" title="RDF::Reader#fail_subject (method)">#fail_subject</a></span>, <span class='object_link'><a href="../Reader.html#for-class_method" title="RDF::Reader.for (method)">for</a></span>, <span class='object_link'><a href="../Reader.html#format-class_method" title="RDF::Reader.format (method)">format</a></span>, <span class='object_link'><a href="../Reader.html#intern%3F-instance_method" title="RDF::Reader#intern? (method)">#intern?</a></span>, <span class='object_link'><a href="../Reader.html#open-class_method" title="RDF::Reader.open (method)">open</a></span>, <span class='object_link'><a href="../Reader.html#prefix-instance_method" title="RDF::Reader#prefix (method)">#prefix</a></span>, <span class='object_link'><a href="../Reader.html#prefixes-instance_method" title="RDF::Reader#prefixes (method)">#prefixes</a></span>, <span class='object_link'><a href="../Reader.html#prefixes%3D-instance_method" title="RDF::Reader#prefixes= (method)">#prefixes=</a></span>, <span class='object_link'><a href="../Reader.html#read_statement-instance_method" title="RDF::Reader#read_statement (method)">#read_statement</a></span>, <span class='object_link'><a href="../Reader.html#read_triple-instance_method" title="RDF::Reader#read_triple (method)">#read_triple</a></span>, <span class='object_link'><a href="../Reader.html#rewind-instance_method" title="RDF::Reader#rewind (method)">#rewind</a></span>, <span class='object_link'><a href="../Reader.html#to_sym-instance_method" title="RDF::Reader#to_sym (method)">#to_sym</a></span>, <span class='object_link'><a href="../Reader.html#to_sym-class_method" title="RDF::Reader.to_sym (method)">to_sym</a></span>, <span class='object_link'><a href="../Reader.html#validate%3F-instance_method" title="RDF::Reader#validate? (method)">#validate?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Util/Aliasing/LateBound.html" title="RDF::Util::Aliasing::LateBound (module)">Util::Aliasing::LateBound</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Util/Aliasing/LateBound.html#alias_method-instance_method" title="RDF::Util::Aliasing::LateBound#alias_method (method)">#alias_method</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Enumerable.html" title="RDF::Enumerable (module)">Enumerable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Enumerable.html#contexts-instance_method" title="RDF::Enumerable#contexts (method)">#contexts</a></span>, <span class='object_link'><a href="../Enumerable.html#dump-instance_method" title="RDF::Enumerable#dump (method)">#dump</a></span>, <span class='object_link'><a href="../Enumerable.html#each_context-instance_method" title="RDF::Enumerable#each_context (method)">#each_context</a></span>, <span class='object_link'><a href="../Enumerable.html#each_graph-instance_method" title="RDF::Enumerable#each_graph (method)">#each_graph</a></span>, <span class='object_link'><a href="../Enumerable.html#each_object-instance_method" title="RDF::Enumerable#each_object (method)">#each_object</a></span>, <span class='object_link'><a href="../Enumerable.html#each_predicate-instance_method" title="RDF::Enumerable#each_predicate (method)">#each_predicate</a></span>, <span class='object_link'><a href="../Enumerable.html#each_quad-instance_method" title="RDF::Enumerable#each_quad (method)">#each_quad</a></span>, <span class='object_link'><a href="../Enumerable.html#each_subject-instance_method" title="RDF::Enumerable#each_subject (method)">#each_subject</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_context-instance_method" title="RDF::Enumerable#enum_context (method)">#enum_context</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_graph-instance_method" title="RDF::Enumerable#enum_graph (method)">#enum_graph</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_object-instance_method" title="RDF::Enumerable#enum_object (method)">#enum_object</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_predicate-instance_method" title="RDF::Enumerable#enum_predicate (method)">#enum_predicate</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_quad-instance_method" title="RDF::Enumerable#enum_quad (method)">#enum_quad</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_statement-instance_method" title="RDF::Enumerable#enum_statement (method)">#enum_statement</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_subject-instance_method" title="RDF::Enumerable#enum_subject (method)">#enum_subject</a></span>, <span class='object_link'><a href="../Enumerable.html#enum_triple-instance_method" title="RDF::Enumerable#enum_triple (method)">#enum_triple</a></span>, <span class='object_link'><a href="../Enumerable.html#has_context%3F-instance_method" title="RDF::Enumerable#has_context? (method)">#has_context?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_object%3F-instance_method" title="RDF::Enumerable#has_object? (method)">#has_object?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_predicate%3F-instance_method" title="RDF::Enumerable#has_predicate? (method)">#has_predicate?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_quad%3F-instance_method" title="RDF::Enumerable#has_quad? (method)">#has_quad?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_statement%3F-instance_method" title="RDF::Enumerable#has_statement? (method)">#has_statement?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_subject%3F-instance_method" title="RDF::Enumerable#has_subject? (method)">#has_subject?</a></span>, <span class='object_link'><a href="../Enumerable.html#has_triple%3F-instance_method" title="RDF::Enumerable#has_triple? (method)">#has_triple?</a></span>, <span class='object_link'><a href="../Enumerable.html#invalid%3F-instance_method" title="RDF::Enumerable#invalid? (method)">#invalid?</a></span>, <span class='object_link'><a href="../Enumerable.html#objects-instance_method" title="RDF::Enumerable#objects (method)">#objects</a></span>, <span class='object_link'><a href="../Enumerable.html#predicates-instance_method" title="RDF::Enumerable#predicates (method)">#predicates</a></span>, <span class='object_link'><a href="../Enumerable.html#quads-instance_method" title="RDF::Enumerable#quads (method)">#quads</a></span>, <span class='object_link'><a href="../Enumerable.html#statements-instance_method" title="RDF::Enumerable#statements (method)">#statements</a></span>, <span class='object_link'><a href="../Enumerable.html#subjects-instance_method" title="RDF::Enumerable#subjects (method)">#subjects</a></span>, <span class='object_link'><a href="../Enumerable.html#supports%3F-instance_method" title="RDF::Enumerable#supports? (method)">#supports?</a></span>, <span class='object_link'><a href="../Enumerable.html#to_a-instance_method" title="RDF::Enumerable#to_a (method)">#to_a</a></span>, <span class='object_link'><a href="../Enumerable.html#to_hash-instance_method" title="RDF::Enumerable#to_hash (method)">#to_hash</a></span>, <span class='object_link'><a href="../Enumerable.html#to_set-instance_method" title="RDF::Enumerable#to_set (method)">#to_set</a></span>, <span class='object_link'><a href="../Enumerable.html#triples-instance_method" title="RDF::Enumerable#triples (method)">#triples</a></span>, <span class='object_link'><a href="../Enumerable.html#valid%3F-instance_method" title="RDF::Enumerable#valid? (method)">#valid?</a></span>, <span class='object_link'><a href="../Enumerable.html#validate%21-instance_method" title="RDF::Enumerable#validate! (method)">#validate!</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Isomorphic.html" title="RDF::Isomorphic (module)">Isomorphic</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Isomorphic.html#bijection_to-instance_method" title="RDF::Isomorphic#bijection_to (method)">#bijection_to</a></span>, <span class='object_link'><a href="../Isomorphic.html#isomorphic_with%3F-instance_method" title="RDF::Isomorphic#isomorphic_with? (method)">#isomorphic_with?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Countable.html" title="RDF::Countable (module)">Countable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Countable.html#count-instance_method" title="RDF::Countable#count (method)">#count</a></span>, <span class='object_link'><a href="../Countable.html#empty%3F-instance_method" title="RDF::Countable#empty? (method)">#empty?</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Readable.html" title="RDF::Readable (module)">RDF::Readable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Readable.html#readable%3F-instance_method" title="RDF::Readable#readable? (method)">#readable?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt>reader</tt>) <strong>initialize</strong>(input = $stdin, options = {}) {|reader| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Initializes the RDFa reader instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>input</span>
      
      
        <span class='type'>(<tt>IO</tt>, <tt>File</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$stdin</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the input stream to read</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>any additional options (see <code>RDF::Reader#initialize</code>)</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:library</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>One of :nokogiri or :rexml. If nil/unspecified uses :nokogiri if available, :rexml otherwise.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:vocab_expansion</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>whether to perform OWL2 expansion on the resulting graph</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:reference_folding</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>whether to perform RDFa property copying on the resulting graph</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:host_language</span>
          <span class="type">(<tt>:xml</tt>, <tt>:xhtml1</tt>, <tt>:xhtml5</tt>, <tt>:html4</tt>, <tt>:html5</tt>, <tt>:svg</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:html5</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Host Language</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:version</span>
          <span class="type">(<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:&quot;rdfa1.1&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Parser version information</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:processor_callback</span>
          <span class="type">(<tt>Proc</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Callback used to provide processor graph triples.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:rdfagraph</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span>&gt;</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>[:output]</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Used to indicate if either or both of the :output or :processor graphs are output.
Value is an array containing on or both of :output or :processor.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:vocab_repository</span>
          <span class="type">(<tt><span class='object_link'><a href="../Repository.html" title="RDF::Repository (class)">Repository</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Repository to save loaded vocabularies.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:debug</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Array to place debug messages</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>reader</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p><code>self</code></p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>reader</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Reader.html" title="RDF::Reader (class)">RDF::Reader</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>void</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>ignored</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../ReaderError.html" title="RDF::ReaderError (class)">RDF::ReaderError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if <em>validate</em></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 277</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_input identifier id'>input</span> <span class='assign token'>=</span> <span class='rubyid_$stdin gvar id'>$stdin</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_super super kw'>super</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_@debug ivar id'>@debug</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:debug</span><span class='rbrack token'>]</span>
    <span class='rubyid_@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:reference_folding</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_@options ivar id'>@options</span><span class='rparen token'>)</span>
    <span class='rubyid_@repository ivar id'>@repository</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Repository constant id'>Repository</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>

    <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_String constant id'>String</span><span class='comma token'>,</span> <span class='rubyid_Symbol constant id'>Symbol</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:strip</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:to_sym</span><span class='rparen token'>)</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_Array constant id'>Array</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_o identifier id'>o</span><span class='bitor op'>|</span> <span class='rubyid_o identifier id'>o</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rbrace token'>}</span>
    <span class='rubyid_else else kw'>else</span>  <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_o identifier id'>o</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='symbol val'>:output</span><span class='comma token'>,</span> <span class='symbol val'>:processor</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_o identifier id'>o</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:output</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

    <span class='rubyid_@library ivar id'>@library</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:library</span><span class='rbrack token'>]</span>
      <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
        <span class='comment val'># Use Nokogiri when available, and REXML otherwise:</span>
        <span class='lparen token'>(</span><span class='rubyid_defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='colon3 op'>::</span><span class='rubyid_Nokogiri constant id'>Nokogiri</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_RUBY_PLATFORM constant id'>RUBY_PLATFORM</span> <span class='neq op'>!=</span> <span class='string val'>'java'</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:nokogiri</span> <span class='colon op'>:</span> <span class='symbol val'>:rexml</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:nokogiri</span><span class='comma token'>,</span> <span class='symbol val'>:rexml</span>
        <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:library</span><span class='rbrack token'>]</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;expected :rexml or :nokogiri, but got #{options[:library].inspect}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_require identifier id'>require</span> <span class='dstring node'>&quot;rdf/rdfa/reader/#{@library}&quot;</span>
    <span class='rubyid_@implementation ivar id'>@implementation</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_@library ivar id'>@library</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:nokogiri</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_Nokogiri constant id'>Nokogiri</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:rexml</span>    <span class='rubyid_then then kw'>then</span> <span class='rubyid_REXML constant id'>REXML</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_extend identifier id'>extend</span><span class='lparen token'>(</span><span class='rubyid_@implementation ivar id'>@implementation</span><span class='rparen token'>)</span>

    <span class='rubyid_detect_host_language_version identifier id'>detect_host_language_version</span><span class='lparen token'>(</span><span class='rubyid_input identifier id'>input</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>

    <span class='rubyid_add_info identifier id'>add_info</span><span class='lparen token'>(</span><span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='dstring node'>&quot;version = #{@version},  host_language = #{@host_language}, library = #{@library}, rdfagraph = #{@options[:rdfagraph].inspect}, expand = #{@options[:vocab_expansion]}&quot;</span><span class='rparen token'>)</span>

    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_initialize_xml identifier id'>initialize_xml</span><span class='lparen token'>(</span><span class='rubyid_input identifier id'>input</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='rubyid_rescue rescue kw'>rescue</span>
      <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Malformed document: #{$!.message}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='string val'>&quot;Empty document&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_root identifier id'>root</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Syntax errors:\n#{doc_errors}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_doc_errors identifier id'>doc_errors</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

    <span class='comment val'># Section 4.2 RDFa Host Language Conformance</span>
    <span class='comment val'>#</span>
    <span class='comment val'># The Host Language may require the automatic inclusion of one or more Initial Contexts</span>
    <span class='rubyid_@host_defaults ivar id'>@host_defaults</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='symbol val'>:vocabulary</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span>
      <span class='symbol val'>:uri_mappings</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
      <span class='symbol val'>:initial_contexts</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='rbrace token'>}</span>

    <span class='rubyid_if if kw'>if</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
      <span class='comment val'># Add default term mappings</span>
      <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>%w(
        alternate appendix bookmark cite chapter contents copyright first glossary help icon index
        last license meta next p3pv1 prev role section stylesheet subsection start top up
        )</span><span class='dot token'>.</span><span class='rubyid_inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_hash identifier id'>hash</span><span class='comma token'>,</span> <span class='rubyid_term identifier id'>term</span><span class='bitor op'>|</span> <span class='rubyid_hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XHV constant id'>XHV</span><span class='lbrack token'>[</span><span class='rubyid_term identifier id'>term</span><span class='rbrack token'>]</span><span class='semicolon token'>;</span> <span class='rubyid_hash identifier id'>hash</span> <span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_case case kw'>case</span> <span class='rubyid_@host_language ivar id'>@host_language</span>
    <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:xml</span><span class='comma token'>,</span> <span class='symbol val'>:svg</span>
      <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:initial_contexts</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_XML_RDFA_CONTEXT constant id'>XML_RDFA_CONTEXT</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:xhtml1</span>
      <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:initial_contexts</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_XML_RDFA_CONTEXT constant id'>XML_RDFA_CONTEXT</span><span class='comma token'>,</span> <span class='rubyid_XHTML_RDFA_CONTEXT constant id'>XHTML_RDFA_CONTEXT</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span>
      <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:initial_contexts</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_XML_RDFA_CONTEXT constant id'>XML_RDFA_CONTEXT</span><span class='comma token'>,</span> <span class='rubyid_HTML_RDFA_CONTEXT constant id'>HTML_RDFA_CONTEXT</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_block identifier id'>block</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_self self kw'>self</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_block_given? fid id'>block_given?</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="host_language-instance_method">
  
    - (<tt>:xml</tt>, ...) <strong>host_language</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Host language</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>:xml</tt>, <tt>:xhtml1</tt>, <tt>:xhtml5</tt>, <tt>:html4</tt>, <tt>:html5</tt>, <tt>:svg</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 85</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_host_language identifier id'>host_language</span>
  <span class='rubyid_@host_language ivar id'>@host_language</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="implementation=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="implementation-instance_method">
  
    - (<tt>Module</tt>) <strong>implementation</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the XML implementation module for this reader instance.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Module</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 101</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_implementation identifier id'>implementation</span>
  <span class='rubyid_@implementation ivar id'>@implementation</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="repository-instance_method">
  
    - (<tt><span class='object_link'><a href="../Repository.html" title="RDF::Repository (class)">RDF::Repository</a></span></tt>) <strong>repository</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Repository used for collecting triples.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Repository.html" title="RDF::Repository (class)">RDF::Repository</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 95</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_repository identifier id'>repository</span>
  <span class='rubyid_@repository ivar id'>@repository</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="version-instance_method">
  
    - (<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>) <strong>version</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Version</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 90</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_version identifier id'>version</span>
  <span class='rubyid_@version ivar id'>@version</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="curie_to_resource_or_bnode-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>curie_to_resource_or_bnode</strong>(element, curie, uri_mappings, subject, restrictions) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>From section 6. CURIE Syntax Definition</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 1408</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_curie identifier id'>curie</span><span class='comma token'>,</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span> <span class='rubyid_subject identifier id'>subject</span><span class='comma token'>,</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
  <span class='comment val'># URI mappings for CURIEs default to XHV, rather than the default doc namespace</span>
  <span class='rubyid_prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='rubyid_reference identifier id'>reference</span> <span class='assign token'>=</span> <span class='rubyid_curie identifier id'>curie</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>

  <span class='comment val'># consider the bnode situation</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_prefix identifier id'>prefix</span> <span class='eq op'>==</span> <span class='string val'>&quot;_&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:bnode</span><span class='rparen token'>)</span>
    <span class='comment val'># we force a non-nil name, otherwise it generates a new name</span>
    <span class='comment val'># As a special case, _: is also a valid reference for one specific bnode.</span>
    <span class='rubyid_bnode identifier id'>bnode</span><span class='lparen token'>(</span><span class='rubyid_reference identifier id'>reference</span><span class='rparen token'>)</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_curie identifier id'>curie</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^:/</span><span class='rparen token'>)</span>
    <span class='comment val'># Default prefix</span>
    <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XHV constant id'>XHV</span><span class='lbrack token'>[</span><span class='rubyid_reference identifier id'>reference</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='rubyid_curie identifier id'>curie</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/:/</span><span class='rparen token'>)</span>
    <span class='comment val'># No prefix, undefined (in this context, it is evaluated as a term elsewhere)</span>
    <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'># Prefixes always downcased</span>
    <span class='rubyid_prefix identifier id'>prefix</span> <span class='assign token'>=</span> <span class='rubyid_prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='dstring node'>&quot;curie_to_resource_or_bnode check for #{prefix.to_s.to_sym.inspect} in #{uri_mappings.inspect}&quot;</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_ns identifier id'>ns</span> <span class='assign token'>=</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='lbrack token'>[</span><span class='rubyid_prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_ns identifier id'>ns</span>
      <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_ns identifier id'>ns</span> <span class='plus op'>+</span> <span class='rubyid_reference identifier id'>reference</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;curie_to_resource_or_bnode No namespace mapping for #{prefix.inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each_statement-instance_method">
  
    - <strong>each_statement</strong> {|statement| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Iterates the given block for each RDF statement in the input.</p>

<p>Reads to graph and performs expansion if required.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>statement</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>statement</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Statement.html" title="RDF::Statement (class)">RDF::Statement</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 357</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_each_statement identifier id'>each_statement</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@processed ivar id'>@processed</span> <span class='orop op'>||</span> <span class='rubyid_@root ivar id'>@root</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='comment val'># Add prefix definitions from host defaults</span>
    <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
      <span class='rubyid_prefix identifier id'>prefix</span><span class='lparen token'>(</span><span class='rubyid_prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># parse</span>
    <span class='rubyid_parse_whole_document identifier id'>parse_whole_document</span><span class='lparen token'>(</span><span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='lparen token'>(</span><span class='rubyid_base_uri identifier id'>base_uri</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='rubyid_def def kw'>def</span> <span class='rubyid_extract_script identifier id'>extract_script</span><span class='lparen token'>(</span><span class='rubyid_el identifier id'>el</span><span class='comma token'>,</span> <span class='rubyid_input identifier id'>input</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_el identifier id'>el</span><span class='comma token'>,</span> <span class='dstring node'>&quot;script element of type #{type}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='comment val'># Formats don't exist unless they've been required</span>
        <span class='rubyid_case case kw'>case</span> <span class='rubyid_type identifier id'>type</span>
        <span class='rubyid_when when kw'>when</span> <span class='string val'>'application/rdf+xml'</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_require identifier id'>require</span> <span class='string val'>'rdf/rdfxml'</span>
        <span class='rubyid_when when kw'>when</span> <span class='string val'>'text/ntriples'</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_require identifier id'>require</span> <span class='string val'>'rdf/ntriples'</span>
        <span class='rubyid_when when kw'>when</span> <span class='string val'>'text/turtle'</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_require identifier id'>require</span> <span class='string val'>'text/turtle'</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_rescue rescue kw'>rescue</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_reader identifier id'>reader</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Reader constant id'>Reader</span><span class='dot token'>.</span><span class='rubyid_for identifier id'>for</span><span class='lparen token'>(</span><span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_el identifier id'>el</span><span class='comma token'>,</span> <span class='dstring node'>&quot;=&gt; reader #{reader.to_sym}&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_reader identifier id'>reader</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_input identifier id'>input</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    
    <span class='comment val'># Look for Embedded Turtle and RDF/XML</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@root ivar id'>@root</span><span class='dot token'>.</span><span class='rubyid_xpath identifier id'>xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;//rdf:RDF&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;xmlns:rdf&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_extract_script identifier id'>extract_script</span><span class='lparen token'>(</span><span class='rubyid_@root ivar id'>@root</span><span class='comma token'>,</span> <span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='string val'>&quot;application/rdf+xml&quot;</span><span class='comma token'>,</span> <span class='rubyid_@options ivar id'>@options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_statement identifier id'>statement</span><span class='bitor op'>|</span>
        <span class='rubyid_@repository ivar id'>@repository</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_statement identifier id'>statement</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Look for Embedded scripts</span>
    <span class='rubyid_@root ivar id'>@root</span><span class='dot token'>.</span><span class='rubyid_css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>&quot;script[type]&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_el identifier id'>el</span><span class='bitor op'>|</span>
      <span class='rubyid_type identifier id'>type</span> <span class='assign token'>=</span> <span class='rubyid_el identifier id'>el</span><span class='dot token'>.</span><span class='rubyid_attribute identifier id'>attribute</span><span class='lparen token'>(</span><span class='string val'>&quot;type&quot;</span><span class='rparen token'>)</span>
      
      <span class='rubyid_extract_script identifier id'>extract_script</span><span class='lparen token'>(</span><span class='rubyid_el identifier id'>el</span><span class='comma token'>,</span> <span class='rubyid_el identifier id'>el</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='rubyid_@options ivar id'>@options</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_statement identifier id'>statement</span><span class='bitor op'>|</span>
        <span class='rubyid_@repository ivar id'>@repository</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_statement identifier id'>statement</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    
    <span class='comment val'># Look for Embedded microdata</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@root ivar id'>@root</span><span class='dot token'>.</span><span class='rubyid_xpath identifier id'>xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;//@itemscope&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='rubyid_require identifier id'>require</span> <span class='string val'>'rdf/microdata'</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='string val'>&quot;process microdata&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_@repository ivar id'>@repository</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Microdata constant id'>Microdata</span><span class='colon2 op'>::</span><span class='rubyid_Reader constant id'>Reader</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
      <span class='rubyid_rescue rescue kw'>rescue</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='string val'>&quot;microdata detected, not processed&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Perform property copying</span>
    <span class='rubyid_copy_properties identifier id'>copy_properties</span><span class='lparen token'>(</span><span class='rubyid_@repository ivar id'>@repository</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:reference_folding</span><span class='rbrack token'>]</span>

    <span class='comment val'># Perform vocabulary expansion</span>
    <span class='rubyid_expand identifier id'>expand</span><span class='lparen token'>(</span><span class='rubyid_@repository ivar id'>@repository</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab_expansion</span><span class='rbrack token'>]</span>
    
    <span class='rubyid_@processed ivar id'>@processed</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Return statements in the default graph for</span>
  <span class='comment val'># statements in the associated named or default graph from the</span>
  <span class='comment val'># processed repository</span>
  <span class='rubyid_@repository ivar id'>@repository</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_statement identifier id'>statement</span><span class='bitor op'>|</span>
    <span class='rubyid_case case kw'>case</span> <span class='rubyid_statement identifier id'>statement</span><span class='dot token'>.</span><span class='rubyid_context identifier id'>context</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_nil nil kw'>nil</span>
      <span class='rubyid_yield yield kw'>yield</span> <span class='rubyid_statement identifier id'>statement</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:output</span><span class='rparen token'>)</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='rubyid_ProcessorGraph constant id'>ProcessorGraph</span>
      <span class='rubyid_yield yield kw'>yield</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Statement constant id'>Statement</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='rubyid_statement identifier id'>statement</span><span class='dot token'>.</span><span class='rubyid_to_triple identifier id'>to_triple</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:rdfagraph</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:processor</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each_triple-instance_method">
  
    - <strong>each_triple</strong> {|subject, predicate, object| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Iterates the given block for each RDF triple in the input.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>subject</tt>, <tt>predicate</tt>, <tt>object</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>subject</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Resource.html" title="RDF::Resource (module)">RDF::Resource</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>predicate</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../URI.html" title="RDF::URI (class)">RDF::URI</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Value.html" title="RDF::Value (module)">RDF::Value</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


442
443
444
445
446</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 442</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_each_triple identifier id'>each_triple</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_each_statement identifier id'>each_statement</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_statement identifier id'>statement</span><span class='bitor op'>|</span>
    <span class='rubyid_block identifier id'>block</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='rubyid_statement identifier id'>statement</span><span class='dot token'>.</span><span class='rubyid_to_triple identifier id'>to_triple</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_term-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>process_term</strong>(element, value, options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>[7.4.3] General Use of Terms in Attributes</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 1388</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_process_term identifier id'>process_term</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span>
    <span class='comment val'># If there is a local default vocabulary, the IRI is obtained by concatenating that value and the term</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='comment val'># If the term is in the local term mappings, use the associated URI (case sensitive).</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rparen token'>)</span>
  
    <span class='comment val'># Otherwise, check for case-insensitive match</span>
    <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_term identifier id'>term</span><span class='comma token'>,</span> <span class='rubyid_uri identifier id'>uri</span><span class='bitor op'>|</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_term identifier id'>term</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Finally, if there is no local default vocabulary, the term has no associated URI and must be ignored.</span>
  <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Term #{value} is not defined&quot;</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='rubyid_UnresolvedTerm constant id'>UnresolvedTerm</span><span class='rparen token'>)</span>
  <span class='rubyid_nil nil kw'>nil</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_uri-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>process_uri</strong>(element, value, evaluation_context, base, options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 1326</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_restrictions identifier id'>restrictions</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:restrictions</span><span class='rbrack token'>]</span>
  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uri: #{value}, restrictions = #{restrictions.inspect}&quot;</span><span class='rbrace token'>}</span>
  <span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:safe_curie</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^\[(.*)\]$/</span><span class='rparen token'>)</span>
    <span class='comment val'># SafeCURIEorCURIEorIRI</span>
    <span class='comment val'># When the value is surrounded by square brackets, then the content within the brackets is</span>
    <span class='comment val'># evaluated as a CURIE according to the CURIE Syntax definition. If it is not a valid CURIE, the</span>
    <span class='comment val'># value must be ignored.</span>
    <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_$1 nth_ref id'>$1</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_uri identifier id'>uri</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uri: #{value} =&gt; safeCURIE =&gt; &lt;#{uri}&gt;&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{value} not matched as a safeCURIE&quot;</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='rubyid_UnresolvedCURIE constant id'>UnresolvedCURIE</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_uri identifier id'>uri</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_TERM_REGEXP constant id'>TERM_REGEXP</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:term</span><span class='rparen token'>)</span>
    <span class='comment val'># TERMorCURIEorAbsIRI</span>
    <span class='comment val'># If the value is an NCName, then it is evaluated as a term according to General Use of Terms in</span>
    <span class='comment val'># Attributes. Note that this step may mean that the value is to be ignored.</span>
    <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_process_term identifier id'>process_term</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uri: #{value} =&gt; term =&gt; &lt;#{uri}&gt;&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_uri identifier id'>uri</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'># SafeCURIEorCURIEorIRI or TERMorCURIEorAbsIRI</span>
    <span class='comment val'># Otherwise, the value is evaluated as a CURIE.</span>
    <span class='comment val'># If it is a valid CURIE, the resulting URI is used; otherwise, the value will be processed as a URI.</span>
    <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_uri identifier id'>uri</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uri: #{value} =&gt; CURIE =&gt; &lt;#{uri}&gt;&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^xml/i</span><span class='rparen token'>)</span>
      <span class='comment val'># Special case to not allow anything starting with XML to be treated as a URI</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:absuri</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:uri</span><span class='rparen token'>)</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='comment val'># AbsURI does not use xml:base</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:absuri</span><span class='rparen token'>)</span>
          <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_uri identifier id'>uri</span><span class='dot token'>.</span><span class='rubyid_absolute? fid id'>absolute?</span>
            <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
            <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Malformed IRI #{uri.inspect}&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_Addressable constant id'>Addressable</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Addressable constant id'>Addressable</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='colon2 op'>::</span><span class='rubyid_InvalidURIError constant id'>InvalidURIError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
        <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Malformed IRI #{value}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_ReaderError constant id'>ReaderError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span><span class='rparen token'>)</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/^\(^\w\):/</span>
          <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Undefined prefix #{$1}&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Relative URI #{value}&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uri: #{value} =&gt; URI =&gt; &lt;#{uri}&gt;&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_uri identifier id'>uri</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_uris-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>process_uris</strong>(element, value, evaluation_context, base, options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>space-separated TERMorCURIEorAbsIRI or SafeCURIEorCURIEorIRI</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1320
1321
1322
1323
1324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 1320</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;process_uris: #{value}&quot;</span><span class='rbrace token'>}</span>
  <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_compact identifier id'>compact</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="traverse-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>traverse</strong>(element, evaluation_context) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The recursive helper function</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 670</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_traverse identifier id'>traverse</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;Can't parse nil element&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_end end kw'>end</span>
  
  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;ec: #{evaluation_context.inspect}&quot;</span> <span class='rbrace token'>}</span>

  <span class='comment val'># local variables [7.5 Step 1]</span>
  <span class='rubyid_recurse identifier id'>recurse</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_skip identifier id'>skip</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
  <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
  <span class='rubyid_namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_namespaces identifier id'>namespaces</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
  <span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_language identifier id'>language</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span>
  <span class='rubyid_term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
  <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span>
  <span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span>

  <span class='rubyid_xml_base identifier id'>xml_base</span> <span class='assign token'>=</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_base identifier id'>base</span>
  <span class='rubyid_base identifier id'>base</span> <span class='assign token'>=</span> <span class='rubyid_xml_base identifier id'>xml_base</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_xml_base identifier id'>xml_base</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span>
  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;base: #{base.inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_base identifier id'>base</span>
  <span class='rubyid_base identifier id'>base</span> <span class='opasgn op'>||=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_base identifier id'>base</span>

  <span class='comment val'># Pull out the attributes needed for the skip test.</span>
  <span class='rubyid_attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='dstring node'>%w(
    about
    content
    datatype
    datetime
    href
    id
    inlist
    property
    rel
    resource
    rev
    role
    src
    typeof
    value
    vocab
  )</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='bitor op'>|</span>
    <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='rubyid_a identifier id'>a</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_strip identifier id'>strip</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='rubyid_a identifier id'>a</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='string val'>&quot;attrs &quot;</span> <span class='plus op'>+</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span><span class='rbrace token'>}</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

  <span class='comment val'># If @property and @rel/@rev are on the same elements, the non-CURIE and non-URI @rel/@rev values are ignored. If, after this, the value of @rel/@rev becomes empty, then the then the processor must act as if the attribute is not present.</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:property</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span> <span class='eq op'>==</span> <span class='symbol val'>:html5</span> <span class='orop op'>||</span> <span class='rubyid_@host_language ivar id'>@host_language</span> <span class='eq op'>==</span> <span class='symbol val'>:xhtml5</span> <span class='orop op'>||</span> <span class='rubyid_@host_language ivar id'>@host_language</span> <span class='eq op'>==</span> <span class='symbol val'>:html4</span><span class='rparen token'>)</span>
    <span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='comma token'>,</span> <span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_attr identifier id'>attr</span><span class='bitor op'>|</span>
      <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='rubyid_attr identifier id'>attr</span><span class='rparen token'>)</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;Remove non-CURIE/non-IRI @#{attr} values from #{attrs[attr].inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='rubyid_attr identifier id'>attr</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='rubyid_attr identifier id'>attr</span><span class='rbrack token'>]</span><span class='dot token'>.</span>
        <span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rparen token'>)</span><span class='dot token'>.</span>
        <span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='bitor op'>|</span> <span class='rubyid_a identifier id'>a</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span>
        <span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot; =&gt; #{attrs[attr].inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_attr identifier id'>attr</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='rubyid_attr identifier id'>attr</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Default vocabulary [7.5 Step 2]</span>
  <span class='comment val'># Next the current element is examined for any change to the default vocabulary via @vocab.</span>
  <span class='comment val'># If @vocab is present and contains a value, its value updates the local default vocabulary.</span>
  <span class='comment val'># If the value is empty, then the local default vocabulary must be reset to the Host Language defined default.</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span>
    <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='comment val'># Set default_vocabulary to host language default</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
        <span class='dstring node'>&quot;[Step 3] reset default_vocaulary to #{@host_defaults.fetch(:vocabulary, nil).inspect}&quot;</span>
      <span class='rbrace token'>}</span>
      <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:vocabulary</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='comment val'># Generate a triple indicating that the vocabulary is used</span>
      <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='rubyid_usesVocabulary identifier id'>usesVocabulary</span><span class='comma token'>,</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

      <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
      <span class='dstring node'>&quot;[Step 2] default_vocaulary: #{default_vocabulary.inspect}&quot;</span>
    <span class='rbrace token'>}</span>
  <span class='rubyid_end end kw'>end</span>
  
  <span class='comment val'># Local term mappings [7.5 Step 3]</span>
  <span class='comment val'># Next, the current element is then examined for URI mapping s and these are added to the local list of URI mappings.</span>
  <span class='comment val'># Note that a URI mapping will simply overwrite any current mapping in the list that has the same name</span>
  <span class='rubyid_extract_mappings identifier id'>extract_mappings</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span> <span class='rubyid_namespaces identifier id'>namespaces</span><span class='rparen token'>)</span>

  <span class='comment val'># Language information [7.5 Step 4]</span>
  <span class='rubyid_language identifier id'>language</span> <span class='assign token'>=</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span> <span class='orop op'>||</span> <span class='rubyid_language identifier id'>language</span>
  <span class='rubyid_language identifier id'>language</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_language identifier id'>language</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;HTML5 [3.2.3.3] lang: #{language.inspect}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_language identifier id'>language</span>

  <span class='comment val'># From HTML5, if the property attribute and the rel and/or rev attribute exists on the same element, the non-CURIE and non-URI rel and rev values are ignored. If, after this, the value of rel and/or rev becomes empty, then the processor must act as if the respective attribute is not present.</span>
  <span class='rubyid_if if kw'>if</span> <span class='lbrack token'>[</span><span class='symbol val'>:html5</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_old_rel identifier id'>old_rel</span><span class='comma token'>,</span> <span class='rubyid_old_rev identifier id'>old_rev</span> <span class='assign token'>=</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_old_rel identifier id'>old_rel</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rubyid_m identifier id'>m</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='rubyid_r identifier id'>r</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:rel</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;HTML5: @rel was #{old_rel}, now #{attrs[:rel]}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_old_rev identifier id'>old_rev</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rubyid_m identifier id'>m</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='rubyid_r identifier id'>r</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:rev</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;HTML5: @rev was #{old_rev}, now #{attrs[:rev]}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># rels and revs</span>
  <span class='rubyid_rels identifier id'>rels</span> <span class='assign token'>=</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_revs identifier id'>revs</span> <span class='assign token'>=</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='dstring node'>&quot;rels: #{rels.join(&quot; &quot;)}, revs: #{revs.join(&quot; &quot;)}&quot;</span>
  <span class='rubyid_end end kw'>end</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='rubyid_rels identifier id'>rels</span> <span class='plus op'>+</span> <span class='rubyid_revs identifier id'>revs</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='comment val'># Establishing a new subject if no rel/rev [7.5 Step 5]</span>
    
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
      <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span>
        <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                    <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                    <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span>
        <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                    <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                    <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span>
        <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='comment val'># If no URI is provided by a resource attribute, then the first match from the following rules</span>
      <span class='comment val'># will apply:</span>
      <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_if if kw'>if</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
        <span class='comment val'># From XHTML+RDFa 1.1:</span>
        <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element.</span>
        <span class='comment val'># If it is, then act as if the new subject is set to the parent object.</span>
        <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_element identifier id'>element</span> <span class='eq op'>==</span> <span class='rubyid_root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_base identifier id'>base</span>
        <span class='comment val'># if the element is the root element of the document, then act as if there is an empty @about present,</span>
        <span class='comment val'># and process it according to the rule for @about, above;</span>
        <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>
        <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='comment val'># otherwise, if parent object is present, new subject is set to the value of parent object.</span>
        <span class='rubyid_skip identifier id'>skip</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span>
        <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='comment val'># if the @typeof attribute is present, set typed resource to new subject</span>
      <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>
    <span class='rubyid_else else kw'>else</span> <span class='comment val'># rdfa1.1</span>
      <span class='comment val'># If the current element contains no @rel or @rev attribute, then the next step is to establish a value for new subject.</span>
      <span class='comment val'># This step has two possible alternatives.</span>
      <span class='comment val'>#  1. If the current element contains the @property attribute, but does not contain the @content or the @datatype attributes, then</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datatype</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='comment val'># new subject is set to the resource obtained from the first match from the following rule:</span>
        <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span>
          <span class='comment val'># by using the resource from @about, if present, obtained according to the section on CURIE and IRI Processing;</span>
          <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
          <span class='comment val'># From XHTML+RDFa 1.1:</span>
          <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element. If it is, then act as if the new subject is set to the parent object.</span>
          <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_element identifier id'>element</span> <span class='eq op'>==</span> <span class='rubyid_root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_base identifier id'>base</span>
          <span class='comment val'># otherwise, if the element is the root element of the document, then act as if there is an empty @about present, and process it according to the rule for @about, above;</span>
          <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='comment val'># if the @typeof attribute is present, set typed resource to new subject</span>
        <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>

        <span class='comment val'># otherwise, if parent object is present, new subject is set to the value of parent object.</span>
        <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>

        <span class='comment val'># If @typeof is present then typed resource is set to the resource obtained from the first match from the following rules:</span>

        <span class='comment val'># by using the resource from @about, if present, obtained according to the section on CURIE and IRI Processing; (done above)</span>
        <span class='comment val'># otherwise, if the element is the root element of the document, then act as if there is an empty @about present and process it according to the previous rule; (done above)</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_typed_resource identifier id'>typed_resource</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
          <span class='comment val'># otherwise,</span>
          <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='opasgn op'>||=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span>
            <span class='comment val'># by using the resource from @resource, if present, obtained according to the section on CURIE and IRI Processing;</span>
            <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                        <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                        <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span>
            <span class='comment val'># otherwise, by using the IRI from @href, if present, obtained according to the section on CURIE and IRI Processing;</span>
            <span class='comment val'># otherwise, by using the IRI from @src, if present, obtained according to the section on CURIE and IRI Processing;</span>
            <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                        <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='rubyid_else else kw'>else</span>
            <span class='comment val'># otherwise, the value of typed resource is set to a newly created bnode.</span>
            <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='comment val'># The value of the current object resource is set to the value of typed resource.</span>
          <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='rubyid_typed_resource identifier id'>typed_resource</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='comment val'># otherwise (ie, the @content or @datatype)</span>
        <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='assign token'>=</span>
          <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                      <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span> <span class='orop op'>||</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span>
        <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span>
          <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span>

        <span class='comment val'># If no URI is provided by a resource attribute, then the first match from the following rules</span>
        <span class='comment val'># will apply:</span>
        <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_if if kw'>if</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
          <span class='comment val'># From XHTML+RDFa 1.1:</span>
          <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element.</span>
          <span class='comment val'># If it is, then act as if the new subject is set to the parent object.</span>
          <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_element identifier id'>element</span> <span class='eq op'>==</span> <span class='rubyid_root identifier id'>root</span>
          <span class='comment val'># if the element is the root element of the document, then act as if there is an empty @about present,</span>
          <span class='comment val'># and process it according to the rule for @about, above;</span>
          <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='comment val'># otherwise, if parent object is present, new subject is set to the value of parent object.</span>
          <span class='comment val'># Additionally, if @property is not present then the skip element flag is set to 'true'.</span>
          <span class='rubyid_skip identifier id'>skip</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span>
          <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='comment val'># If @typeof is present then typed resource is set to the resource obtained from the first match from the following rules:</span>
        <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
      <span class='dstring node'>&quot;[Step 5] new_subject: #{new_subject.to_ntriples rescue 'nil'}, &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;typed_resource: #{typed_resource.to_ntriples rescue 'nil'}, &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;current_object_resource: #{current_object_resource.to_ntriples rescue 'nil'}, &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;skip = #{skip}&quot;</span>
    <span class='rbrace token'>}</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'># [7.5 Step 6]</span>
    <span class='comment val'># If the current element does contain a @rel or @rev attribute, then the next step is to</span>
    <span class='comment val'># establish both a value for new subject and a value for current object resource:</span>
    <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
  
    <span class='comment val'># if the @typeof attribute is present, set typed resource to new subject</span>
    <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>

    <span class='comment val'># If no URI is provided then the first match from the following rules will apply</span>
    <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='rubyid_if if kw'>if</span> <span class='rubyid_element identifier id'>element</span> <span class='eq op'>==</span> <span class='rubyid_root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_base identifier id'>base</span>
      <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
      <span class='comment val'># From XHTML+RDFa 1.1:</span>
      <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element.</span>
      <span class='comment val'># If it is, then act as if the new subject is set to the parent object.</span>
      <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
      <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='comment val'># if it's null, it's null and nothing changes</span>
      <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span>
      <span class='comment val'># no skip flag set this time</span>
    <span class='rubyid_end end kw'>end</span>
  
    <span class='comment val'># Then the current object resource is set to the URI obtained from the first match from the following rules:</span>
    <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span>
    <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='opasgn op'>||=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span>
    <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='opasgn op'>||=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@version ivar id'>@version</span> <span class='neq op'>!=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
    <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='opasgn op'>||=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@version ivar id'>@version</span> <span class='neq op'>!=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>

    <span class='comment val'># and also set the value typed resource to this bnode</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
        <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='assign token'>=</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
      <span class='dstring node'>&quot;[Step 6] new_subject: #{new_subject}, &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;current_object_resource = #{current_object_resource.nil? ? 'nil' : current_object_resource} &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;typed_resource: #{typed_resource.to_ntriples rescue 'nil'}, &quot;</span>
    <span class='rbrace token'>}</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># [Step 7] If in any of the previous steps a typed resource was set to a non-null value, it is now used to provide a subject for type values;</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_typed_resource identifier id'>typed_resource</span>
    <span class='comment val'># Typeof is TERMorCURIEorAbsIRIs</span>
    <span class='rubyid_types identifier id'>types</span> <span class='assign token'>=</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:typeof</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                        <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                        <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                        <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                        <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 7] typeof: #{attrs[:typeof]}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_types identifier id'>types</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_one_type identifier id'>one_type</span><span class='bitor op'>|</span>
      <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_typed_resource identifier id'>typed_resource</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='lbrack token'>[</span><span class='string val'>&quot;type&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_one_type identifier id'>one_type</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Create new List mapping [step 8]</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If in any of the previous steps a new subject was set to a non-null value different from the parent object;</span>
  <span class='comment val'># The list mapping taken from the evaluation context is set to a new, empty mapping.</span>
  <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_new_subject identifier id'>new_subject</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_new_subject identifier id'>new_subject</span> <span class='neq op'>!=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span> <span class='orop op'>||</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='dstring node'>&quot;[Step 8]: create new list mapping(#{list_mapping.object_id}) &quot;</span> <span class='plus op'>+</span>
        <span class='dstring node'>&quot;ns: #{new_subject.to_ntriples}, &quot;</span> <span class='plus op'>+</span>
        <span class='dstring node'>&quot;ps: #{evaluation_context.parent_subject.to_ntriples rescue 'nil'}&quot;</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Generate triples with given object [Step 9]</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If in any of the previous steps a current object resource was set to a non-null value, it is now used to generate triples and add entries to the local list mapping:</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 9] rels: #{rels.inspect} revs: #{revs.inspect}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_rels identifier id'>rels</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:inlist</span><span class='rbrack token'>]</span>
        <span class='comment val'># If the current list mapping does not contain a list associated with this IRI,</span>
        <span class='comment val'># instantiate a new list</span>
        <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span>
          <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_List constant id'>List</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;list(#{r}): create #{list_mapping[r].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 9] add #{current_object_resource.to_ntriples} to #{r} #{list_mapping[r].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='comment val'># Predicates for the current object resource can be set by using one or both of the @rel and the @rev attributes but, in case of the @rel attribute, only if the @inlist is not present:</span>
        <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='rubyid_r identifier id'>r</span><span class='comma token'>,</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  
    <span class='rubyid_revs identifier id'>revs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span><span class='comma token'>,</span> <span class='rubyid_r identifier id'>r</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span>
    <span class='comment val'># Incomplete triples and bnode creation [Step 10]</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 10] incompletes: rels: #{rels}, revs: #{revs}&quot;</span><span class='rbrace token'>}</span>
    <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  
    <span class='comment val'># predicate: full IRI</span>
    <span class='comment val'># direction: forward/reverse</span>
    <span class='comment val'># lists: Save into list, don't generate triple</span>

    <span class='rubyid_rels identifier id'>rels</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:inlist</span><span class='rbrack token'>]</span>
        <span class='comment val'># If the current list mapping does not contain a list associated with this IRI,</span>
        <span class='comment val'># instantiate a new list</span>
        <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span>
          <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_List constant id'>List</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 10] list(#{r}): create #{list_mapping[r].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:list</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:direction</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:none</span><span class='rbrace token'>}</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:predicate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_r identifier id'>r</span><span class='comma token'>,</span> <span class='symbol val'>:direction</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:forward</span><span class='rbrace token'>}</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  
    <span class='rubyid_revs identifier id'>revs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:predicate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_r identifier id'>r</span><span class='comma token'>,</span> <span class='symbol val'>:direction</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:reverse</span><span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Establish current object literal [Step 11]</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If the current element has a @inlist attribute, add the property to the</span>
  <span class='comment val'># list associated with that property, creating a new list if necessary.</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span>
    <span class='rubyid_properties identifier id'>properties</span> <span class='assign token'>=</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:property</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='rubyid_properties identifier id'>properties</span><span class='dot token'>.</span><span class='rubyid_reject! fid id'>reject!</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_p identifier id'>p</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_p identifier id'>p</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='rparen token'>)</span>
        <span class='rubyid_false false kw'>false</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11] predicate #{p.to_ntriples} must be a URI&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_true true kw'>true</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_datatype identifier id'>datatype</span> <span class='assign token'>=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datatype</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                          <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                          <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                          <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                          <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datatype</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_current_property_value identifier id'>current_property_value</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span>
      <span class='rubyid_when when kw'>when</span> <span class='rubyid_datatype identifier id'>datatype</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_XMLLiteral constant id'>XMLLiteral</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_HTML constant id'>HTML</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_datatype identifier id'>datatype</span><span class='rparen token'>)</span>
        <span class='comment val'># typed literal</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11] typed literal (#{datatype})&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datetime</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:value</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_datatype identifier id'>datatype</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
      <span class='rubyid_when when kw'>when</span> <span class='rubyid_@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.1&quot;</span>
        <span class='rubyid_case case kw'>case</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_XMLLiteral constant id'>XMLLiteral</span>
          <span class='comment val'># XML Literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11] XML Literal: #{element.inner_html}&quot;</span><span class='rbrace token'>}</span>

          <span class='comment val'># In order to maintain maximum portability of this literal, any children of the current node that are</span>
          <span class='comment val'># elements must have the current in scope XML namespace declarations (if any) declared on the</span>
          <span class='comment val'># serialized element using their respective attributes. Since the child element node could also</span>
          <span class='comment val'># declare new XML namespaces, the RDFa Processor must be careful to merge these together when</span>
          <span class='comment val'># generating the serialized element definition. For avoidance of doubt, any re-declarations on the</span>
          <span class='comment val'># child node must take precedence over declarations that were active on the current node.</span>
          <span class='rubyid_begin begin kw'>begin</span>
            <span class='rubyid_c14nxl identifier id'>c14nxl</span> <span class='assign token'>=</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_children identifier id'>children</span><span class='dot token'>.</span><span class='rubyid_c14nxl identifier id'>c14nxl</span><span class='lparen token'>(</span>
              <span class='symbol val'>:library</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@library ivar id'>@library</span><span class='comma token'>,</span>
              <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span>
              <span class='symbol val'>:namespaces</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rubyid_nil nil kw'>nil</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_XHTML constant id'>XHTML</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_namespaces identifier id'>namespaces</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_c14nxl identifier id'>c14nxl</span><span class='comma token'>,</span>
              <span class='symbol val'>:library</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@library ivar id'>@library</span><span class='comma token'>,</span>
              <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_XMLLiteral constant id'>XMLLiteral</span><span class='comma token'>,</span>
              <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span>
              <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
          <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
            <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_HTML constant id'>HTML</span>
          <span class='comment val'># HTML Literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11] HTML Literal: #{element.inner_html}&quot;</span><span class='rbrace token'>}</span>

          <span class='comment val'># Just like XMLLiteral, but without the c14nxl</span>
          <span class='rubyid_begin begin kw'>begin</span>
            <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_children identifier id'>children</span><span class='dot token'>.</span><span class='rubyid_to_html identifier id'>to_html</span><span class='comma token'>,</span>
              <span class='symbol val'>:library</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@library ivar id'>@library</span><span class='comma token'>,</span>
              <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_HTML constant id'>HTML</span><span class='comma token'>,</span>
              <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span>
              <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
          <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
            <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datatype</span><span class='rbrack token'>]</span>
          <span class='comment val'># otherwise, as a plain literal if @datatype is present but has an empty value.</span>
          <span class='comment val'># The actual literal is either the value of @content (if present) or a string created by</span>
          <span class='comment val'># concatenating the value of all descendant text nodes, of the current element in turn.</span>
          <span class='comment val'># typed literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11] plain plain (#{datatype})&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span>
          <span class='comment val'># plain literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11] plain literal (content)&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='eq op'>==</span> <span class='string val'>'time'</span>
          <span class='comment val'># HTML5 support</span>
          <span class='comment val'># Lexically scan value and assign appropriate type, otherwise, leave untyped</span>
          <span class='rubyid_v identifier id'>v</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datetime</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
          <span class='rubyid_datatype identifier id'>datatype</span> <span class='assign token'>=</span> <span class='dstring node'>%w(Date Time DateTime Year YearMonth Duration)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='rubyid_t identifier id'>t</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_detect identifier id'>detect</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_dt identifier id'>dt</span><span class='bitor op'>|</span>
            <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='rubyid_dt identifier id'>dt</span><span class='colon2 op'>::</span><span class='rubyid_GRAMMAR constant id'>GRAMMAR</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span> <span class='orop op'>||</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11] &lt;time&gt; literal: #{datatype} #{v.inspect}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='rparen token'>)</span>
        <span class='rubyid_when when kw'>when</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
             <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rel</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:rev</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
             <span class='rubyid_@version ivar id'>@version</span> <span class='neq op'>!=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11] resource (resource|href|src)&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_res identifier id'>res</span> <span class='assign token'>=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                            <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                            <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_SafeCURIEorCURIEorIRI constant id'>SafeCURIEorCURIEorIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span>
          <span class='rubyid_res identifier id'>res</span> <span class='opasgn op'>||=</span> <span class='rubyid_process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:src</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='rubyid_when when kw'>when</span> <span class='rubyid_typed_resource identifier id'>typed_resource</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:about</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@version ivar id'>@version</span> <span class='neq op'>!=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11] typed_resource&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_typed_resource identifier id'>typed_resource</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='comment val'># plain literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11] plain literal (inner text)&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_else else kw'>else</span> <span class='comment val'># rdfa1.0</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_text_content? fid id'>text_content?</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_children identifier id'>children</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:datatype</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;&quot;</span>
          <span class='comment val'># plain literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11 (1.0)] plain literal&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_text_content? fid id'>text_content?</span> <span class='rubyid_and and kw'>and</span> <span class='lparen token'>(</span><span class='rubyid_datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='rubyid_nil nil kw'>nil</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_XMLLiteral constant id'>XMLLiteral</span><span class='rparen token'>)</span>
          <span class='comment val'># XML Literal</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11 (1.0)] XML Literal: #{element.inner_html}&quot;</span><span class='rbrace token'>}</span>
          <span class='rubyid_recurse identifier id'>recurse</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
          <span class='rubyid_c14nxl identifier id'>c14nxl</span> <span class='assign token'>=</span> <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_children identifier id'>children</span><span class='dot token'>.</span><span class='rubyid_c14nxl identifier id'>c14nxl</span><span class='lparen token'>(</span>
            <span class='symbol val'>:library</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@library ivar id'>@library</span><span class='comma token'>,</span>
            <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_language identifier id'>language</span><span class='comma token'>,</span>
            <span class='symbol val'>:namespaces</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rubyid_nil nil kw'>nil</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_XHTML constant id'>XHTML</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_namespaces identifier id'>namespaces</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Literal constant id'>Literal</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_c14nxl identifier id'>c14nxl</span><span class='comma token'>,</span>
            <span class='symbol val'>:library</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@library ivar id'>@library</span><span class='comma token'>,</span>
            <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_XMLLiteral constant id'>XMLLiteral</span><span class='comma token'>,</span>
            <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_validate? fid id'>validate?</span><span class='comma token'>,</span>
            <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># add each property</span>
    <span class='rubyid_properties identifier id'>properties</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_p identifier id'>p</span><span class='bitor op'>|</span>
      <span class='comment val'># Lists: If element has an @inlist attribute, add the value to a list</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:inlist</span><span class='rbrack token'>]</span>
        <span class='comment val'># If the current list mapping does not contain a list associated with this IRI,</span>
        <span class='comment val'># instantiate a new list</span>
        <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_p identifier id'>p</span><span class='rbrack token'>]</span>
          <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_p identifier id'>p</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_List constant id'>List</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
          <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11] lists(#{p}): create #{list_mapping[p].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span>  <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 11] add #{current_property_value.to_ntriples} to #{p.to_ntriples} #{list_mapping[p].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_p identifier id'>p</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_current_property_value identifier id'>current_property_value</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_new_subject identifier id'>new_subject</span>
        <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='rubyid_p identifier id'>p</span><span class='comma token'>,</span> <span class='rubyid_current_property_value identifier id'>current_property_value</span><span class='rparen token'>)</span> 
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_skip identifier id'>skip</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='comment val'># Complete the incomplete triples from the evaluation context [Step 12]</span>
    <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='string val'>&quot;[Step 12] complete incomplete triples: &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;new_subject=#{new_subject.to_ntriples}, &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;completes=#{evaluation_context.incomplete_triples.inspect}&quot;</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_trip identifier id'>trip</span><span class='bitor op'>|</span>
      <span class='rubyid_case case kw'>case</span> <span class='rubyid_trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:direction</span><span class='rbrack token'>]</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:none</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 12] add #{new_subject.to_ntriples} to #{trip[:list].inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='rubyid_trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:list</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_new_subject identifier id'>new_subject</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:forward</span>
        <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='rubyid_trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:predicate</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='rparen token'>)</span>
      <span class='rubyid_when when kw'>when</span> <span class='symbol val'>:reverse</span>
        <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='rubyid_trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:predicate</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Create a new evaluation context and proceed recursively [Step 13]</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_recurse identifier id'>recurse</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_skip identifier id'>skip</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_language identifier id'>language</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_uri_mappings identifier id'>uri_mappings</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_uri_mappings identifier id'>uri_mappings</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_term_mappings identifier id'>term_mappings</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_term_mappings identifier id'>term_mappings</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_base identifier id'>base</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_base identifier id'>base</span> <span class='andop op'>&amp;&amp;</span>
          <span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='eq op'>==</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] skip: reused ec&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_base identifier id'>base</span> <span class='assign token'>=</span> <span class='rubyid_base identifier id'>base</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span> <span class='assign token'>=</span> <span class='rubyid_language identifier id'>language</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='rubyid_namespaces identifier id'>namespaces</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span>
        <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='assign token'>=</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] skip: cloned ec&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='comment val'># create a new evaluation context</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='rubyid_EvaluationContext constant id'>EvaluationContext</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='rubyid_@host_defaults ivar id'>@host_defaults</span><span class='rparen token'>)</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span> <span class='assign token'>=</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='orop op'>||</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_parent_object identifier id'>parent_object</span> <span class='assign token'>=</span> <span class='rubyid_current_object_resource identifier id'>current_object_resource</span> <span class='orop op'>||</span> <span class='rubyid_new_subject identifier id'>new_subject</span> <span class='orop op'>||</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_parent_subject identifier id'>parent_subject</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='rubyid_namespaces identifier id'>namespaces</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span> <span class='assign token'>=</span> <span class='rubyid_incomplete_triples identifier id'>incomplete_triples</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_language identifier id'>language</span> <span class='assign token'>=</span> <span class='rubyid_language identifier id'>language</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='rubyid_default_vocabulary identifier id'>default_vocabulary</span>
      <span class='rubyid_new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='assign token'>=</span> <span class='rubyid_list_mapping identifier id'>list_mapping</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] new ec&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  
    <span class='rubyid_element identifier id'>element</span><span class='dot token'>.</span><span class='rubyid_children identifier id'>children</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_child identifier id'>child</span><span class='bitor op'>|</span>
      <span class='comment val'># recurse only if it's an element</span>
      <span class='rubyid_traverse identifier id'>traverse</span><span class='lparen token'>(</span><span class='rubyid_child identifier id'>child</span><span class='comma token'>,</span> <span class='rubyid_new_ec identifier id'>new_ec</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_child identifier id'>child</span><span class='dot token'>.</span><span class='rubyid_element? fid id'>element?</span>
    <span class='rubyid_end end kw'>end</span>
    
    <span class='comment val'># Step 14: after traversing through child elements, for each list associated with</span>
    <span class='comment val'># a property</span>
    <span class='lparen token'>(</span><span class='rubyid_list_mapping identifier id'>list_mapping</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_p identifier id'>p</span><span class='comma token'>,</span> <span class='rubyid_l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='comment val'># if that list is different from the evaluation context</span>
      <span class='rubyid_ec_list identifier id'>ec_list</span> <span class='assign token'>=</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span><span class='lbrack token'>[</span><span class='rubyid_p identifier id'>p</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='rubyid_list_mapping identifier id'>list_mapping</span>
      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 14] time to create #{l.inspect}? #{(ec_list != l).inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_ec_list identifier id'>ec_list</span> <span class='neq op'>!=</span> <span class='rubyid_l identifier id'>l</span>
        <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;[Step 14] list(#{p}) create #{l.inspect}&quot;</span><span class='rbrace token'>}</span>
        <span class='comment val'># Generate an rdf:List with the elements of that list.</span>
        <span class='rubyid_l identifier id'>l</span><span class='dot token'>.</span><span class='rubyid_each_statement identifier id'>each_statement</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_st identifier id'>st</span><span class='bitor op'>|</span>
          <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_st identifier id'>st</span><span class='dot token'>.</span><span class='rubyid_subject identifier id'>subject</span><span class='comma token'>,</span> <span class='rubyid_st identifier id'>st</span><span class='dot token'>.</span><span class='rubyid_predicate identifier id'>predicate</span><span class='comma token'>,</span> <span class='rubyid_st identifier id'>st</span><span class='dot token'>.</span><span class='rubyid_object identifier id'>object</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_st identifier id'>st</span><span class='dot token'>.</span><span class='rubyid_object identifier id'>object</span> <span class='eq op'>==</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_List constant id'>List</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='comment val'># Generate a triple relating new_subject, property and the list BNode,</span>
        <span class='comment val'># or rdf:nil if the list is empty.</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_l identifier id'>l</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
          <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='rubyid_p identifier id'>p</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='dot token'>.</span><span class='rubyid_nil identifier id'>nil</span><span class='rparen token'>)</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='rubyid_p identifier id'>p</span><span class='comma token'>,</span> <span class='rubyid_l identifier id'>l</span><span class='dot token'>.</span><span class='rubyid_subject identifier id'>subject</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># Role processing</span>
    <span class='comment val'># @id is used as subject, bnode otherwise.</span>
    <span class='comment val'># Predicate is xhv:role</span>
    <span class='comment val'># Objects are TERMorCURIEorAbsIRIs.</span>
    <span class='comment val'># Act as if the default vocabulary is XHV</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:role</span><span class='rbrack token'>]</span>
      <span class='rubyid_subject identifier id'>subject</span> <span class='assign token'>=</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span> <span class='dstring node'>&quot;##{attrs[:id]}&quot;</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_Node constant id'>Node</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
      <span class='rubyid_roles identifier id'>roles</span> <span class='assign token'>=</span> <span class='rubyid_process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='symbol val'>:role</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='rubyid_base identifier id'>base</span><span class='comma token'>,</span>
                                <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                                <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                                <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XHV constant id'>XHV</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='comma token'>,</span>
                                <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_TERMorCURIEorAbsIRI constant id'>TERMorCURIEorAbsIRI</span><span class='dot token'>.</span><span class='rubyid_fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='rubyid_@version ivar id'>@version</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

      <span class='rubyid_add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='dstring node'>&quot;role: about: #{subject.to_ntriples}, roles: #{roles.map(&amp;:to_ntriples).inspect}&quot;</span><span class='rbrace token'>}</span>
      <span class='rubyid_roles identifier id'>roles</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
        <span class='rubyid_add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='rubyid_element identifier id'>element</span><span class='comma token'>,</span> <span class='rubyid_subject identifier id'>subject</span><span class='comma token'>,</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_XHV constant id'>XHV</span><span class='dot token'>.</span><span class='rubyid_role identifier id'>role</span><span class='comma token'>,</span> <span class='rubyid_r identifier id'>r</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="uri-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>uri</strong>(value, append = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1439
1440
1441
1442
1443
1444
1445
1446</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'vendor/bundler/ruby/1.8/bundler/gems/rdf-rdfa-d758a2ebf995/lib/rdf/rdfa/reader.rb', line 1439</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_uri identifier id'>uri</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_append identifier id'>append</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_append identifier id'>append</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_append identifier id'>append</span>
  <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_validate! fid id'>validate!</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_validate? fid id'>validate?</span>
  <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_canonicalize! fid id'>canonicalize!</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_canonicalize? fid id'>canonicalize?</span>
  <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='rubyid_URI constant id'>URI</span><span class='dot token'>.</span><span class='rubyid_intern identifier id'>intern</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_intern? fid id'>intern?</span>
  <span class='rubyid_value identifier id'>value</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun Feb  3 13:50:28 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.8.7).
</div>

  </body>
</html>